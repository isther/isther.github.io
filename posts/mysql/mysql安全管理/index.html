<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>MySQL安全管理 | Ther's Blog</title>
<meta name=keywords content="数据库,MySQL,外键约束,事务安全,预处理,视图,数据备份与还原">
<meta name=description content="简单介绍了一下数据库">
<meta name=author content="Ther">
<link rel=canonical href=https://canonical.url/to/page>
<meta name=google-site-verification content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw+W8mWdq36u97PLc=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.niuwx.cn/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://www.niuwx.cn/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=https://www.niuwx.cn/favicon.ico>
<link rel=apple-touch-icon href=https://www.niuwx.cn/favicon.ico>
<link rel=mask-icon href=https://www.niuwx.cn/favicon.ico>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script><meta property="og:title" content="MySQL安全管理">
<meta property="og:description" content="简单介绍了一下数据库">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.niuwx.cn/posts/mysql/mysql%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-07-30T10:02:51+08:00">
<meta property="article:modified_time" content="2021-07-30T10:02:51+08:00"><meta property="og:site_name" content="Ther's Blog">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="MySQL安全管理">
<meta name=twitter:description content="简单介绍了一下数据库">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.niuwx.cn/posts/"},{"@type":"ListItem","position":2,"name":"MySQL安全管理","item":"https://www.niuwx.cn/posts/mysql/mysql%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MySQL安全管理","name":"MySQL安全管理","description":"简单介绍了一下数据库","keywords":["数据库","MySQL","外键约束","事务安全","预处理","视图","数据备份与还原"],"articleBody":"结构-执行-管理-用户\n外键约束 概念：foreign key，表中指向外部主键的字段\n 外键必须要通过语法指定才能称之为外键  [constraint 外键名] foreign key (当前表字段名) references 外部表(主键字段)   外键构成条件  外键字段必须与对应表的主键字段类型一致 外键字段本身要求是一个索引（创建外键会自动生成一个索引）    示例   创建专业表和学生表，学生表中的专业id指向专业表id\n# 专业表 CREATE table t1 ( id int primary key AUTO_INCREMENT, name varchar(50) not null unique ) charset utf8; # 学生表 create table t2( id int primary key AUTO_INCREMENT, name varchar(50) not null, c_id int comment '指向专业表t1的主键' constraint `c_id` FOREIGN KEY(c_id) REFERENCES t1(id) ) charset utf8; 外键可以不指定名字，系统会自动生成\n  外键约束  当表建立外键关系后，外键就会对主表和子表里的数据产生约束效果 外键约束的是写操作（默认操作）  新增：子表插入的数据对应的外键必须在主表存在 修改：主表的记录如果在子表存在，那么主表的主键不能修改（其他字段可修改） 删除：主表的记录如果在子表存在，那么主表的主键不能删除   外键约束控制：外键可以定义时控制外键的约束作用  控制类型  on update：父表更新时子表的表现 on delete：父表删除时子表的表现   控制方式  cascade：级联操作，父表操作后自编跟随操作 set null：置空操作，父表操作后，子表关联的外键字段置空 restrict/no action：严格模式，不允许父表操作（默认）      示例   子表不能插入主表不存在的数据\ninsert into t2 values(null,'Tony',2);# 此时父表中还没有id=2的记录，错误  insert into t1 values(null,'English'); insert into t2 values(null,'Peny',1);   默认的外键产生后，主键不能更新被关联的主键字段或者删除被关联的主键记录\n# 错误 update t1 set id = 2; delete from t1 where id = 1;   限制外键约束，一般使用更新级联，删除置空\n on update cascade：更新级联 on delete set null：删除置空  create table t3( id int primary key AUTO_INCREMENT, name varchar(50) not null unique )charset utf8; create table t4( id int primary key AUTO_INCREMENT, name varchar(50) not null, c_id int , # 如果允许置空，就不能not null  FOREIGN KEY(c_id) references t3(id) on update cascade on delete set null )charset utf8; insert into t3 values(null,'Chinese'),(null,'Computer'); insert into t4 values(null,'Tony',1),(null,'Lily',2);  子表依然不允许插入父表不存在的外键 但是可以插入外键为Null的数据  # 错误 insert into t2 values(null,'Lilei',3); insert into t2 vlaues(null,'Lilei',null);  父表的更新（主键）会让关联的外键自动级联更新  update t1 set id = 3 where id = 1;   外键管理   在表创建后期维护外键\n  新增外键\nalter table 表名 add [constraint `外键名`] foreign key(外键字段) references 表名(主键) [on 外键约束]   删除外键\nalter table 表名 drop foreign key 外键名;   更新外键：先删除后新增\n  事务安全 事务：要做的某个事情\n  计算机中的事务是指某个程序执行单元（写操作）\n  事务安全：当事务执行后，保障事务的执行是有效的，而不会导致数据错乱\n  事务安全通常针对的是一连串的操作（多个事务）而产生的统一结果\n  MySQL中默认的写操作是直接写入的\n 执行写操作SQL 同步到数据表    示例 银行转账\ncreate table t1( id int primary key auto_increment, `name` varchar(50) not null, account decimal(10,2) default 0.00 )charset utf8; insert into t1 values(null,'Tom',10000),(null,'Lucy',100); # Tom扣钱 update t1 set account = account - 100 where id = 1; # Lucy收钱 update t1 set account = account + 1000;  扣钱，收钱两步都成功转账才叫成功 为了保障两步都成功才能叫事务安全  事务处理  利用手动或者手动方式实现事务管理 自动事务处理：系统默认，操作结束直接同步到数据表（事务关闭状态）  系统控制：变量autocommit（值为ON，自动提交）   手动事务处理  开启事务：start transaction 关闭事务：  提交事务：commit，同步到数据表，同时清空日志数据 回滚事务：rollback 只清空日志数据     事务回滚：在长事务执行中，可以在某个已经成功的节点设置回滚点，后续回滚的可以回到某个成功点  设置回滚点：savepoint 回滚点名字 回滚到回滚点：rollback to 回滚点名字    示例   手动事务：启用事务转账，成功提交事务\n# 开启事务 start transaction; # Tom扣钱 update t1 set account = account - 1000; # Lucy收钱 update t1 set account = account + 1000; # 提交事务 commit;   手动事务：启用事务转账，成功提交事务（回滚点）\n# 开启事务 start transaction; # Tom扣钱 update t1 set account = account - 1000 where id = 1; # 设置回滚点 savepoint spl; # Lucy收钱 update t1 set account = account + 1000 where id = 2; # 操作失败回到回滚点 rollback spl; update t1 set account = account - 1000 where id = 2; # 提交事务 commit;   自动事务\n MySQL默认自动提交事务，事务一旦发生就会立即写入数据表  show variables like 'autucommit';  关闭自动提交事务（当前设置级别用户级：当前用户当此连接有效）  set autocommit = 0;  手动提交事务  insert into t1 values(null,'Liu',1000); commit;   事务特点  ACID四大特性 原子性(Atomicity)：一个事务操作是一个整体，不可拆分，要么都成功，要么都失败 一致性(Consistency)：事务执行之前和执行之后都必须处于一致性状态，数据的完整性没有被破坏（事务逻辑的准确性） 隔离性(Isolation)：事务操作过程中，其他事务不可见 持久性(Durability)：事务一旦提交，结果不可改变  预处理 预处理：prepare statement，一种预先编译SQL指令的方式\n 预处理不同于直接处理，是将要执行的SQL指令先发送给服务器编译，然后通过指令执行  发送预处理：prepare 预处理名字 from '要执行的SQL指令' 执行预处理：execute 预处理名字   预处理管理  预处理属于会话级别：即当前用户当次连接有效（断开会被服务器清理掉） 删除预处理：deallocate | drop 预处理名字    示例 查询学生的SQL指令需要重复执行很多次\n# 普通操作 select * from t1; # 预处理操作：发送预处理 prepare pl from 'select * from t1'; # 预处理操作：执行预处理 execute pl; # 删除预处理 deallocate | drop pl; 预处理传参   在执行预处理的时候传入预处理需要的可变数据\n  一般预处理都不会是固定死的SQL指令，而是具有一些数据可变的执行（条件）\n  可变数据的位置使用占位符?占位\nprepare 预处理名字 from '预处理指令 变化部分使用?代替'     在执行预处理的时候将实际数据传进去代替占位符执行SQL\n  数据存储到变量（预处理传入的值必须是变量保存的）\nset @变量名 = 值   使用using关键字传参\nexecute 预处理名字 using @变量名   数据传入的顺序与预处理中占位符的顺序一致\n    示例 向表中插入数据\n# 准备预处理：涉及参数 prepare t1 insert from 'insert into t1 values(null,?,?,?,?)'; # 设置变量并传入参数 set @name = '药师兜'; set @gender = '男'; set @age = 23; set @class_name = '木叶1班'; #执行预处理 execute t1 insert using @name,@gender,@age,@@class_name; 视图 视图：view，一种由select指令组成的虚拟表\n  视图时虚拟表，可以使用表管理（结构管理）\n 为视图提供数据的表叫做基表    # 创建视图 create view 视图名字 as select指令; # 访问视图：一般都是查询 select */字段名 from 视图名字;   视图有结构，但不存储数据\n 结构：select选择的字段 数据：访问视图时执行的select指令    对外部系统提供数据支撑(保护基表数据)\n  示例   需要对外提供一个学生详情的数据，经常使用，可以利用视图实现\n# 对外提供数据，要保护数据本身的安全 # 需要长期使用  # 创建视图 create view v_student_info as select * from t1 left join t2 using(c_id); # 使用视图：像表一样使用 select * from v_student_info;   有些复杂的SQL又是经常用到的，如多张表的连表操作：可以利用视图实现\n# 院系表 create table t1( id int primary key auto_increment, `name` varchar(50) not null )charset utf8; insert into t1 values(null,'语言系'),(null,'考古系'); # 专业表 create table t2( id int primary key auto_increment, `name` varchar(50) not null, s_id int not null comment '学院id' )charset utf8; insert into t2 values(null,'English',1),(null,'Chinese',1); # 学生表 create table t3( id int primary key auto_increment, `name` varchar(50) not null, s_id int not null comment '专业id' )charset utf8; insert into t3 values(null,'Lilei',2),(null,'Hanmeimei',2),(null,'Tony',1); # 获取所有学生的明细信息 select stu.*,sub.name as sub_name,sub.s_id as sch_id,sch.name as sch_name from t3 as stu left join t2 sub on stu.s_id = sub.id left join t1 sch on sub.s_id = sch.id; # 以视图保存这类复杂指令，后续可以直接访问视图 create view v_student_detail as select stu.*,sub.name as sub_name,sub.s_id as sch_id,sch.name as sch_name from t3 as stu left join t2 sub on stu.s_id = sub.id left join t1 sch on sub.s_id = sch.id;   视图管理   视图查看：显示视图结构和具体视图信息\nshow tables; #查看全部视图 show create table/view 视图名字; # 查看视图创建指令 desc 视图名字; # 查看视图结构   视图修改：更改视图逻辑\nalter view 视图名 as 新的查询命令; create or replace view 视图名 as 新的查询命令 # 创建新的或者替换新的   删除视图\ndrop view 视图名;   视图的数据操作   视图所有的数据操作都是最终对基表的数据操作\n  视图操作条件\n  多基表视图：不允许操作\n  单基表视图：允许增删改\n 新增条件：视图的字段必须包含基表中所有不允许为空的字段    with check option：操作检查规则\n 默认不需要这个规则（创建视图时指定）：视图操作只要满足前面上述条件即可 增加此规则：视图的数据操作后，必须要保证该视图还能把通过视图操作的数据查出来（否则失败）    示例     增加一个单表视图和多表视图\ncreate view v_student_1 as select s_id,s_name from t1; create view v_student_2 as select s.*,c.c_name from t1 s left join t2 c using(c_id); create or replace view v_student_3 as select * from t1 where c_id is not null with check option;   新增数据\ninsert into v_student_1 values(null,'student7'); # 正确：视图包含所有必有字段 insert into v_student_2 values(null,'student8',null,null) # 错误：不可插入 insert into v_student_3 values(null,'student8',null) # 错误：check option，因为第三个字段c_id为null,不符合视图筛选条件，查不出来 insert into v_student_3 valeus(null,'student9',1) # 正确   更新数据\nupdate v_student_1 set s_name = 'boy' where s_id = 8; update v_student_2 set s_name = 'boy' where s_id = 7; # 错误：不可修改 update v_student_3 set c_id = null where s_id = 1; # 错误：check option，修改后c_id为null，变得不符合视图筛选条件 update v_student_3 set s_name = 'boy' where s_id = 1;   删除数据\ndelete from v_student_1 where s_id = 2; delete from v_student_2 where s_id = 3; # 错误：不可修改 delete from v_student_3 where s_id = 1; # 可以删除，check option不影响删除操作   视图算法   视图在执行过程中对于内部的select指令的处理方式\n  视图算法在创建视图时指定\ncreate ALGORITHM = 算法 view 视图名字 as select指令;   视图算法一共有三种\n undefined：默认的，未定义算法，即系统自动选择算法 merge：合并算法，就是将视图外部查询语句跟视图内部select语句合并执行，效率高（系统优先选择） temptable：临时表算法，即系统将视图的select语句查出来先得出一张临时表，然后外部再查询（temptable算法视图不允许写操作）    数据备份与还原 表数据备份  单独针对表里的数据部分进行备份（数据导出） 将数据从表中查出，按照一定格式存储到外部文件  字段格式化：fields  terminated by：字段数据结束后使用的符号，默认是空格 enclosed by：字段数据包裹，默认什么都没有 escaped by：特殊字符的处理，默认是转义   行格式化：lines  terminated by：行结束符号，默认是\\n，自动换行 starting by：行开始符号，默认没有      select 字段列表|* into outfile '外部文件路径' [fields terminated by 格式 enclosed by 格式] [lines terminated by 格式 starting by 格式] from 数据表;  表数据备份不限定数据的来源是一张表还是多张表（可以连表）  表数据还原  将符合数据结构的数据导入到数据表中（数据导入） 将一定格式的数据按照一定的解析方式解析成符合表字段格式的数据导入到数据表  字段处理 行处理    load data infile '数据文件所在路径' into table 表名 [fields terminated by 格式 enclosed by 格式] [lines terminated by 格式 starting by 格式] [(字段列表)];  数据文件来源  表数据备份的数据文件 外部获取或者制作的符合格式的数据    文件备份  直接对数据表进行文件保留，属于物理备份 文件备份操作简单，直接将数据表（或者数据库文件夹）进行保存迁移 MySQL中不同表存储引擎产生的文件不一致，保存手段也不一致  InnoDB：表结构文件再ibd文件夹中，数据和索引存储在外部统一的ibdata文件夹中 MyIsam：每张表的数据、结构和索引都是独立文件，直接找到三个文件迁移即可    文件还原  利用备份的文件，替换出现问题的文件，还原到备份前的良好状态 直接将备份文件放到相应位置即可 文件还原影响  InnoDB：单表结构，整库数据，知识和整库备份还原，否则会影响其他InnoDB存储表 MyIsam：单表备份，单表还原，不影响其他任何数据    ​\n","wordCount":"971","inLanguage":"en","datePublished":"2021-07-30T10:02:51+08:00","dateModified":"2021-07-30T10:02:51+08:00","author":{"@type":"Person","name":"Ther"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.niuwx.cn/posts/mysql/mysql%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86/"},"publisher":{"@type":"Organization","name":"Ther's Blog","logo":{"@type":"ImageObject","url":"https://www.niuwx.cn/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://www.niuwx.cn/ accesskey=h title="Ther's Blog (Alt + H)">Ther's Blog</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://www.niuwx.cn/ title=Home>
<span>Home</span>
</a>
</li>
<li>
<a href=https://www.niuwx.cn/archive title=Archives>
<span>Archives</span>
</a>
</li>
<li>
<a href=https://www.niuwx.cn/categories title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://www.niuwx.cn/tags title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://www.niuwx.cn/search title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://www.niuwx.cn/>Home</a>&nbsp;»&nbsp;<a href=https://www.niuwx.cn/posts/>Posts</a></div>
<h1 class=post-title>
MySQL安全管理
</h1>
<div class=post-description>
简单介绍了一下数据库
</div>
<div class=post-meta>July 30, 2021&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Ther&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/MySQL/MySQL%e5%ae%89%e5%85%a8%e7%ae%a1%e7%90%86.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header> <div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#%e5%a4%96%e9%94%ae%e7%ba%a6%e6%9d%9f aria-label=外键约束>外键约束</a><ul>
<ul>
<li>
<a href=#%e7%a4%ba%e4%be%8b aria-label=示例>示例</a></li></ul>
<li>
<a href=#%e5%a4%96%e9%94%ae%e7%ba%a6%e6%9d%9f-1 aria-label=外键约束>外键约束</a><ul>
<li>
<a href=#%e7%a4%ba%e4%be%8b-1 aria-label=示例>示例</a></li></ul>
</li>
<li>
<a href=#%e5%a4%96%e9%94%ae%e7%ae%a1%e7%90%86 aria-label=外键管理>外键管理</a></li></ul>
</li>
<li>
<a href=#%e4%ba%8b%e5%8a%a1%e5%ae%89%e5%85%a8 aria-label=事务安全>事务安全</a><ul>
<ul>
<li>
<a href=#%e7%a4%ba%e4%be%8b-2 aria-label=示例>示例</a></li></ul>
<li>
<a href=#%e4%ba%8b%e5%8a%a1%e5%a4%84%e7%90%86 aria-label=事务处理>事务处理</a><ul>
<li>
<a href=#%e7%a4%ba%e4%be%8b-3 aria-label=示例>示例</a></li></ul>
</li>
<li>
<a href=#%e4%ba%8b%e5%8a%a1%e7%89%b9%e7%82%b9 aria-label=事务特点>事务特点</a></li></ul>
</li>
<li>
<a href=#%e9%a2%84%e5%a4%84%e7%90%86 aria-label=预处理>预处理</a><ul>
<ul>
<li>
<a href=#%e7%a4%ba%e4%be%8b-4 aria-label=示例>示例</a></li></ul>
<li>
<a href=#%e9%a2%84%e5%a4%84%e7%90%86%e4%bc%a0%e5%8f%82 aria-label=预处理传参>预处理传参</a><ul>
<li>
<a href=#%e7%a4%ba%e4%be%8b-5 aria-label=示例>示例</a></li></ul>
</li></ul>
</li>
<li>
<a href=#%e8%a7%86%e5%9b%be aria-label=视图>视图</a><ul>
<ul>
<li>
<a href=#%e7%a4%ba%e4%be%8b-6 aria-label=示例>示例</a></li></ul>
<li>
<a href=#%e8%a7%86%e5%9b%be%e7%ae%a1%e7%90%86 aria-label=视图管理>视图管理</a></li>
<li>
<a href=#%e8%a7%86%e5%9b%be%e7%9a%84%e6%95%b0%e6%8d%ae%e6%93%8d%e4%bd%9c aria-label=视图的数据操作>视图的数据操作</a><ul>
<li>
<a href=#%e7%a4%ba%e4%be%8b-7 aria-label=示例>示例</a></li></ul>
</li>
<li>
<a href=#%e8%a7%86%e5%9b%be%e7%ae%97%e6%b3%95 aria-label=视图算法>视图算法</a></li></ul>
</li>
<li>
<a href=#%e6%95%b0%e6%8d%ae%e5%a4%87%e4%bb%bd%e4%b8%8e%e8%bf%98%e5%8e%9f aria-label=数据备份与还原>数据备份与还原</a><ul>
<li>
<a href=#%e8%a1%a8%e6%95%b0%e6%8d%ae%e5%a4%87%e4%bb%bd aria-label=表数据备份>表数据备份</a></li>
<li>
<a href=#%e8%a1%a8%e6%95%b0%e6%8d%ae%e8%bf%98%e5%8e%9f aria-label=表数据还原>表数据还原</a></li>
<li>
<a href=#%e6%96%87%e4%bb%b6%e5%a4%87%e4%bb%bd aria-label=文件备份>文件备份</a></li>
<li>
<a href=#%e6%96%87%e4%bb%b6%e8%bf%98%e5%8e%9f aria-label=文件还原>文件还原</a>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>结构->执行->管理->用户</p>
<h3 id=外键约束>外键约束<a hidden class=anchor aria-hidden=true href=#外键约束>#</a></h3>
<p><strong>概念</strong>：<code>foreign key</code>，表中<strong>指向外部主键</strong>的字段</p>
<ul>
<li>外键必须要通过语法指定才能称之为外键
<ul>
<li><code>[constraint 外键名] foreign key (当前表字段名) references 外部表(主键字段)</code></li>
</ul>
</li>
<li>外键构成条件
<ul>
<li>外键字段必须与对应表的主键字段类型一致</li>
<li>外键字段本身要求是一个索引（创建外键会自动生成一个索引）</li>
</ul>
</li>
</ul>
<h5 id=示例>示例<a hidden class=anchor aria-hidden=true href=#示例>#</a></h5>
<ol>
<li>
<p>创建专业表和学生表，学生表中的专业id指向专业表id</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e># 专业表
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>table</span> <span style=color:#a6e22e>t1</span> (
	id <span style=color:#66d9ef>int</span> <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,
	name <span style=color:#66d9ef>varchar</span>(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>unique</span>
) <span style=color:#66d9ef>charset</span> utf8;

<span style=color:#75715e># 学生表
</span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> <span style=color:#a6e22e>t2</span>(
	id <span style=color:#66d9ef>int</span> <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,
	name <span style=color:#66d9ef>varchar</span>(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
	c_id <span style=color:#66d9ef>int</span> comment <span style=color:#e6db74>&#39;指向专业表t1的主键&#39;</span>
	<span style=color:#66d9ef>constraint</span> <span style=color:#f92672>`</span>c_id<span style=color:#f92672>`</span> <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span>(c_id) <span style=color:#66d9ef>REFERENCES</span> <span style=color:#a6e22e>t1</span>(id)
) <span style=color:#66d9ef>charset</span> utf8;
</code></pre></div><p>外键可以不指定名字，系统会自动生成</p>
</li>
</ol>
<h4 id=外键约束-1>外键约束<a hidden class=anchor aria-hidden=true href=#外键约束-1>#</a></h4>
<ul>
<li>当表建立外键关系后，外键就会对主表和子表里的数据产生约束效果</li>
<li>外键约束的是写操作（默认操作）
<ul>
<li>新增：子表插入的数据对应的外键必须在主表存在</li>
<li>修改：主表的记录如果在子表存在，那么主表的主键不能修改（其他字段可修改）</li>
<li>删除：主表的记录如果在子表存在，那么主表的主键不能删除</li>
</ul>
</li>
<li>外键约束控制：外键可以定义时控制外键的约束作用
<ul>
<li>控制类型
<ul>
<li><code>on update</code>：父表更新时子表的表现</li>
<li><code>on delete</code>：父表删除时子表的表现</li>
</ul>
</li>
<li>控制方式
<ul>
<li><code>cascade</code>：级联操作，父表操作后自编跟随操作</li>
<li><code>set null</code>：置空操作，父表操作后，子表关联的外键字段置空</li>
<li><code>restrict/no action</code>：严格模式，不允许父表操作（默认）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id=示例-1>示例<a hidden class=anchor aria-hidden=true href=#示例-1>#</a></h5>
<ol>
<li>
<p>子表不能插入主表不存在的数据</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t2 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Tony&#39;</span>,<span style=color:#ae81ff>2</span>);<span style=color:#75715e># 此时父表中还没有id=2的记录，错误
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t1 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;English&#39;</span>);
<span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t2 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Peny&#39;</span>,<span style=color:#ae81ff>1</span>);
</code></pre></div></li>
<li>
<p>默认的外键产生后，主键不能更新被关联的主键字段或者删除被关联的主键记录</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e># 错误
</span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> t1 <span style=color:#66d9ef>set</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
<span style=color:#66d9ef>delete</span> <span style=color:#66d9ef>from</span> t1 <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</code></pre></div></li>
<li>
<p>限制外键约束，一般使用更新级联，删除置空</p>
<ul>
<li><code>on update cascade</code>：更新级联</li>
<li><code>on delete set null</code>：删除置空</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> <span style=color:#a6e22e>t3</span>(
    id <span style=color:#66d9ef>int</span> <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,
    name <span style=color:#66d9ef>varchar</span>(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>unique</span>
)<span style=color:#66d9ef>charset</span> utf8;

<span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> <span style=color:#a6e22e>t4</span>(
    id <span style=color:#66d9ef>int</span> <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> <span style=color:#66d9ef>AUTO_INCREMENT</span>,
    name <span style=color:#66d9ef>varchar</span>(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
    c_id <span style=color:#66d9ef>int</span> , <span style=color:#75715e># 如果允许置空，就不能not null
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>FOREIGN</span> <span style=color:#66d9ef>KEY</span>(c_id) <span style=color:#66d9ef>references</span> <span style=color:#a6e22e>t3</span>(id) <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>update</span> <span style=color:#66d9ef>cascade</span> <span style=color:#66d9ef>on</span> <span style=color:#66d9ef>delete</span> <span style=color:#66d9ef>set</span> <span style=color:#66d9ef>null</span>
)<span style=color:#66d9ef>charset</span> utf8;

<span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t3 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Chinese&#39;</span>),(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Computer&#39;</span>);
<span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t4 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Tony&#39;</span>,<span style=color:#ae81ff>1</span>),(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Lily&#39;</span>,<span style=color:#ae81ff>2</span>);
</code></pre></div><ul>
<li>子表依然不允许插入父表不存在的外键</li>
<li>但是可以插入外键为Null的数据</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e># 错误
</span><span style=color:#75715e></span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t2 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Lilei&#39;</span>,<span style=color:#ae81ff>3</span>);

<span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t2 <span style=color:#a6e22e>vlaues</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Lilei&#39;</span>,<span style=color:#66d9ef>null</span>);
</code></pre></div><ul>
<li>父表的更新（主键）会让关联的外键自动级联更新</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>update</span> t1 <span style=color:#66d9ef>set</span> id  <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</code></pre></div></li>
</ol>
<h4 id=外键管理>外键管理<a hidden class=anchor aria-hidden=true href=#外键管理>#</a></h4>
<ul>
<li>
<p>在表创建后期维护外键</p>
</li>
<li>
<p>新增外键</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> <span style=color:#960050;background-color:#1e0010>表名</span> <span style=color:#66d9ef>add</span> [<span style=color:#66d9ef>constraint</span> <span style=color:#f92672>`</span><span style=color:#960050;background-color:#1e0010>外键名</span><span style=color:#f92672>`</span>] <span style=color:#66d9ef>foreign</span> <span style=color:#66d9ef>key</span>(<span style=color:#960050;background-color:#1e0010>外键字段</span>) <span style=color:#66d9ef>references</span> <span style=color:#960050;background-color:#1e0010>表名</span>(<span style=color:#960050;background-color:#1e0010>主键</span>) [<span style=color:#66d9ef>on</span> <span style=color:#960050;background-color:#1e0010>外键约束</span>]
</code></pre></div></li>
<li>
<p>删除外键</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>alter</span> <span style=color:#66d9ef>table</span> <span style=color:#960050;background-color:#1e0010>表名</span> <span style=color:#66d9ef>drop</span> <span style=color:#66d9ef>foreign</span> <span style=color:#66d9ef>key</span> <span style=color:#960050;background-color:#1e0010>外键名</span>;
</code></pre></div></li>
<li>
<p>更新外键：先删除后新增</p>
</li>
</ul>
<h3 id=事务安全>事务安全<a hidden class=anchor aria-hidden=true href=#事务安全>#</a></h3>
<p><strong>事务</strong>：要做的某个事情</p>
<ul>
<li>
<p>计算机中的事务是指某个程序执行单元（写操作）</p>
</li>
<li>
<p>事务安全：当事务执行后，保障事务的执行是有效的，而不会导致数据错乱</p>
</li>
<li>
<p>事务安全通常针对的是一连串的操作（多个事务）而产生的统一结果</p>
</li>
<li>
<p>MySQL中默认的写操作是直接写入的</p>
<ul>
<li>执行写操作SQL</li>
<li>同步到数据表</li>
</ul>
</li>
</ul>
<h5 id=示例-2>示例<a hidden class=anchor aria-hidden=true href=#示例-2>#</a></h5>
<p>银行转账</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> <span style=color:#a6e22e>t1</span>(
	id <span style=color:#66d9ef>int</span> <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> <span style=color:#66d9ef>auto_increment</span>,
	<span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> <span style=color:#66d9ef>varchar</span>(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
	account <span style=color:#66d9ef>decimal</span>(<span style=color:#ae81ff>10</span>,<span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>default</span> <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span>
)<span style=color:#66d9ef>charset</span> utf8;

<span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t1 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Tom&#39;</span>,<span style=color:#ae81ff>10000</span>),(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Lucy&#39;</span>,<span style=color:#ae81ff>100</span>);

<span style=color:#75715e># Tom扣钱
</span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> t1 <span style=color:#66d9ef>set</span> account <span style=color:#f92672>=</span> account <span style=color:#f92672>-</span> <span style=color:#ae81ff>100</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
<span style=color:#75715e># Lucy收钱
</span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> t1 <span style=color:#66d9ef>set</span> account <span style=color:#f92672>=</span> account <span style=color:#f92672>+</span> <span style=color:#ae81ff>1000</span>;
</code></pre></div><ul>
<li>扣钱，收钱两步都成功转账才叫成功</li>
<li>为了保障两步都成功才能叫事务安全</li>
</ul>
<h4 id=事务处理>事务处理<a hidden class=anchor aria-hidden=true href=#事务处理>#</a></h4>
<ul>
<li>利用手动或者手动方式实现事务管理</li>
<li>自动事务处理：系统默认，操作结束直接同步到数据表（事务关闭状态）
<ul>
<li>系统控制：变量<code>autocommit</code>（值为ON，自动提交）</li>
</ul>
</li>
<li>手动事务处理
<ul>
<li>开启事务：<code>start transaction</code></li>
<li>关闭事务：
<ul>
<li>提交事务：<code>commit</code>，同步到数据表，同时清空日志数据</li>
<li>回滚事务：<code>rollback</code> 只清空日志数据</li>
</ul>
</li>
</ul>
</li>
<li>事务回滚：在长事务执行中，可以在某个已经成功的节点设置回滚点，后续回滚的可以回到某个成功点
<ul>
<li>设置回滚点：<code>savepoint 回滚点名字</code></li>
<li>回滚到回滚点：<code>rollback to 回滚点名字</code></li>
</ul>
</li>
</ul>
<h5 id=示例-3>示例<a hidden class=anchor aria-hidden=true href=#示例-3>#</a></h5>
<ol>
<li>
<p>手动事务：启用事务转账，成功提交事务</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e># 开启事务
</span><span style=color:#75715e></span>start transaction;

<span style=color:#75715e># Tom扣钱
</span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> t1 <span style=color:#66d9ef>set</span> account <span style=color:#f92672>=</span> account <span style=color:#f92672>-</span> <span style=color:#ae81ff>1000</span>;

<span style=color:#75715e># Lucy收钱
</span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> t1 <span style=color:#66d9ef>set</span> account <span style=color:#f92672>=</span> account <span style=color:#f92672>+</span> <span style=color:#ae81ff>1000</span>;

<span style=color:#75715e># 提交事务
</span><span style=color:#75715e></span>commit;
</code></pre></div></li>
<li>
<p>手动事务：启用事务转账，成功提交事务（回滚点）</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e># 开启事务
</span><span style=color:#75715e></span>start transaction;

<span style=color:#75715e># Tom扣钱
</span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> t1 <span style=color:#66d9ef>set</span> account <span style=color:#f92672>=</span> account <span style=color:#f92672>-</span> <span style=color:#ae81ff>1000</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;

<span style=color:#75715e># 设置回滚点
</span><span style=color:#75715e></span>savepoint spl;

<span style=color:#75715e># Lucy收钱
</span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> t1 <span style=color:#66d9ef>set</span> account <span style=color:#f92672>=</span> account <span style=color:#f92672>+</span> <span style=color:#ae81ff>1000</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;

<span style=color:#75715e># 操作失败回到回滚点
</span><span style=color:#75715e></span>rollback spl;

<span style=color:#66d9ef>update</span> t1 <span style=color:#66d9ef>set</span> account <span style=color:#f92672>=</span> account <span style=color:#f92672>-</span> <span style=color:#ae81ff>1000</span> <span style=color:#66d9ef>where</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;

<span style=color:#75715e># 提交事务
</span><span style=color:#75715e></span>commit;
</code></pre></div></li>
<li>
<p>自动事务</p>
<ul>
<li>MySQL默认自动提交事务，事务一旦发生就会立即写入数据表</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>show</span> variables <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;autucommit&#39;</span>;
</code></pre></div><ul>
<li>关闭自动提交事务（当前设置级别用户级：当前用户当此连接有效）</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>set</span> autocommit <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</code></pre></div><ul>
<li>手动提交事务</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t1 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Liu&#39;</span>,<span style=color:#ae81ff>1000</span>);
commit;
</code></pre></div></li>
</ol>
<h4 id=事务特点>事务特点<a hidden class=anchor aria-hidden=true href=#事务特点>#</a></h4>
<ul>
<li>ACID四大特性</li>
<li>原子性(Atomicity)：一个事务操作是一个整体，不可拆分，要么都成功，要么都失败</li>
<li>一致性(Consistency)：事务执行之前和执行之后都必须处于一致性状态，数据的完整性没有被破坏（事务逻辑的准确性）</li>
<li>隔离性(Isolation)：事务操作过程中，其他事务不可见</li>
<li>持久性(Durability)：事务一旦提交，结果不可改变</li>
</ul>
<h3 id=预处理>预处理<a hidden class=anchor aria-hidden=true href=#预处理>#</a></h3>
<p><strong>预处理</strong>：prepare statement，一种预先编译SQL指令的方式</p>
<ul>
<li>预处理不同于直接处理，是将要执行的SQL指令先发送给服务器编译，然后通过指令执行
<ul>
<li>发送预处理：<code>prepare 预处理名字 from '要执行的SQL指令'</code></li>
<li>执行预处理：<code>execute 预处理名字</code></li>
</ul>
</li>
<li>预处理管理
<ul>
<li>预处理属于会话级别：即当前用户当次连接有效（断开会被服务器清理掉）</li>
<li>删除预处理：<code>deallocate | drop 预处理名字</code></li>
</ul>
</li>
</ul>
<h5 id=示例-4>示例<a hidden class=anchor aria-hidden=true href=#示例-4>#</a></h5>
<p>查询学生的SQL指令需要重复执行很多次</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e># 普通操作
</span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> t1;

<span style=color:#75715e># 预处理操作：发送预处理
</span><span style=color:#75715e></span>prepare pl <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;select * from t1&#39;</span>;

<span style=color:#75715e># 预处理操作：执行预处理
</span><span style=color:#75715e></span>execute pl;
 
<span style=color:#75715e># 删除预处理
</span><span style=color:#75715e></span>deallocate <span style=color:#f92672>|</span> <span style=color:#66d9ef>drop</span> pl;
</code></pre></div><h4 id=预处理传参>预处理传参<a hidden class=anchor aria-hidden=true href=#预处理传参>#</a></h4>
<ul>
<li>
<p>在执行预处理的时候传入预处理需要的可变数据</p>
</li>
<li>
<p>一般预处理都不会是固定死的SQL指令，而是具有一些数据可变的执行（条件）</p>
<ul>
<li>
<p>可变数据的位置使用占位符<code>?</code>占位</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql>prepare <span style=color:#960050;background-color:#1e0010>预处理名字</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;预处理指令  变化部分使用?代替&#39;</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p>在执行预处理的时候将实际数据传进去代替占位符执行SQL</p>
<ul>
<li>
<p>数据存储到变量（预处理传入的值必须是变量保存的）</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>set</span> <span style=color:#f92672>@</span><span style=color:#960050;background-color:#1e0010>变量名</span> <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>值</span>
</code></pre></div></li>
<li>
<p>使用using关键字传参</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql>execute <span style=color:#960050;background-color:#1e0010>预处理名字</span> <span style=color:#66d9ef>using</span> <span style=color:#f92672>@</span><span style=color:#960050;background-color:#1e0010>变量名</span>
</code></pre></div></li>
<li>
<p>数据传入的顺序与预处理中占位符的顺序一致</p>
</li>
</ul>
</li>
</ul>
<h5 id=示例-5>示例<a hidden class=anchor aria-hidden=true href=#示例-5>#</a></h5>
<p>向表中插入数据</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e># 准备预处理：涉及参数
</span><span style=color:#75715e></span>prepare t1 <span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;insert into t1 values(null,?,?,?,?)&#39;</span>;

<span style=color:#75715e># 设置变量并传入参数
</span><span style=color:#75715e></span><span style=color:#66d9ef>set</span> <span style=color:#f92672>@</span>name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;药师兜&#39;</span>;
<span style=color:#66d9ef>set</span> <span style=color:#f92672>@</span>gender <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;男&#39;</span>;
<span style=color:#66d9ef>set</span> <span style=color:#f92672>@</span>age <span style=color:#f92672>=</span> <span style=color:#ae81ff>23</span>;
<span style=color:#66d9ef>set</span> <span style=color:#f92672>@</span>class_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;木叶1班&#39;</span>;

<span style=color:#75715e>#执行预处理
</span><span style=color:#75715e></span>execute t1 <span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>using</span> <span style=color:#f92672>@</span>name,<span style=color:#f92672>@</span>gender,<span style=color:#f92672>@</span>age,<span style=color:#f92672>@@</span>class_name;
</code></pre></div><h3 id=视图>视图<a hidden class=anchor aria-hidden=true href=#视图>#</a></h3>
<p><strong>视图</strong>：view，一种由select指令组成的虚拟表</p>
<ul>
<li>
<p>视图时虚拟表，可以使用表管理（结构管理）</p>
<ul>
<li>为视图提供数据的表叫做基表</li>
</ul>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e># 创建视图
</span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> view <span style=color:#960050;background-color:#1e0010>视图名字</span> <span style=color:#66d9ef>as</span> select指令;

<span style=color:#75715e># 访问视图：一般都是查询
</span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*/</span><span style=color:#960050;background-color:#1e0010>字段名</span> <span style=color:#66d9ef>from</span> <span style=color:#960050;background-color:#1e0010>视图名字</span>;
</code></pre></div><ul>
<li>
<p>视图有结构，但不存储数据</p>
<ul>
<li>结构：select选择的字段</li>
<li>数据：访问视图时执行的select指令</li>
</ul>
</li>
<li>
<p>对外部系统提供数据支撑(保护基表数据)</p>
</li>
</ul>
<h5 id=示例-6>示例<a hidden class=anchor aria-hidden=true href=#示例-6>#</a></h5>
<ol>
<li>
<p>需要对外提供一个学生详情的数据，经常使用，可以利用视图实现</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e># 对外提供数据，要保护数据本身的安全
</span><span style=color:#75715e># 需要长期使用
</span><span style=color:#75715e></span>
<span style=color:#75715e># 创建视图
</span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> view v_student_info <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> t1 <span style=color:#66d9ef>left</span> <span style=color:#66d9ef>join</span> t2 <span style=color:#66d9ef>using</span>(c_id);

<span style=color:#75715e># 使用视图：像表一样使用
</span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> v_student_info;
</code></pre></div></li>
<li>
<p>有些复杂的SQL又是经常用到的，如多张表的连表操作：可以利用视图实现</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#75715e># 院系表
</span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> <span style=color:#a6e22e>t1</span>(
	id <span style=color:#66d9ef>int</span> <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> <span style=color:#66d9ef>auto_increment</span>,
	<span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> <span style=color:#66d9ef>varchar</span>(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>
)<span style=color:#66d9ef>charset</span> utf8;

<span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t1 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;语言系&#39;</span>),(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;考古系&#39;</span>);

<span style=color:#75715e># 专业表
</span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> <span style=color:#a6e22e>t2</span>(
	id <span style=color:#66d9ef>int</span> <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> <span style=color:#66d9ef>auto_increment</span>,
	<span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> <span style=color:#66d9ef>varchar</span>(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
	s_id <span style=color:#66d9ef>int</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> comment <span style=color:#e6db74>&#39;学院id&#39;</span>
)<span style=color:#66d9ef>charset</span> utf8;

<span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t2 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;English&#39;</span>,<span style=color:#ae81ff>1</span>),(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Chinese&#39;</span>,<span style=color:#ae81ff>1</span>);

<span style=color:#75715e># 学生表
</span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span> <span style=color:#a6e22e>t3</span>(
	id <span style=color:#66d9ef>int</span> <span style=color:#66d9ef>primary</span> <span style=color:#66d9ef>key</span> <span style=color:#66d9ef>auto_increment</span>,
	<span style=color:#f92672>`</span>name<span style=color:#f92672>`</span> <span style=color:#66d9ef>varchar</span>(<span style=color:#ae81ff>50</span>) <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span>,
	s_id <span style=color:#66d9ef>int</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> comment <span style=color:#e6db74>&#39;专业id&#39;</span>
)<span style=color:#66d9ef>charset</span> utf8;

<span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> t3 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Lilei&#39;</span>,<span style=color:#ae81ff>2</span>),(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Hanmeimei&#39;</span>,<span style=color:#ae81ff>2</span>),(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;Tony&#39;</span>,<span style=color:#ae81ff>1</span>);


<span style=color:#75715e># 获取所有学生的明细信息
</span><span style=color:#75715e></span><span style=color:#66d9ef>select</span> stu.<span style=color:#f92672>*</span>,sub.name <span style=color:#66d9ef>as</span> sub_name,sub.s_id <span style=color:#66d9ef>as</span> sch_id,sch.name <span style=color:#66d9ef>as</span> sch_name <span style=color:#66d9ef>from</span> t3 <span style=color:#66d9ef>as</span> stu <span style=color:#66d9ef>left</span> <span style=color:#66d9ef>join</span> t2 sub <span style=color:#66d9ef>on</span> stu.s_id <span style=color:#f92672>=</span> sub.id <span style=color:#66d9ef>left</span> <span style=color:#66d9ef>join</span> t1 sch <span style=color:#66d9ef>on</span> sub.s_id <span style=color:#f92672>=</span> sch.id;

<span style=color:#75715e># 以视图保存这类复杂指令，后续可以直接访问视图
</span><span style=color:#75715e></span><span style=color:#66d9ef>create</span> view v_student_detail <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>select</span> stu.<span style=color:#f92672>*</span>,sub.name <span style=color:#66d9ef>as</span> sub_name,sub.s_id <span style=color:#66d9ef>as</span> sch_id,sch.name <span style=color:#66d9ef>as</span> sch_name <span style=color:#66d9ef>from</span> t3 <span style=color:#66d9ef>as</span> stu <span style=color:#66d9ef>left</span> <span style=color:#66d9ef>join</span> t2 sub <span style=color:#66d9ef>on</span> stu.s_id <span style=color:#f92672>=</span> sub.id <span style=color:#66d9ef>left</span> <span style=color:#66d9ef>join</span> t1 sch <span style=color:#66d9ef>on</span> sub.s_id <span style=color:#f92672>=</span> sch.id;
</code></pre></div></li>
</ol>
<h4 id=视图管理>视图管理<a hidden class=anchor aria-hidden=true href=#视图管理>#</a></h4>
<ul>
<li>
<p>视图查看：显示视图结构和具体视图信息</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>show</span> <span style=color:#66d9ef>tables</span>; <span style=color:#75715e>#查看全部视图
</span><span style=color:#75715e></span><span style=color:#66d9ef>show</span> <span style=color:#66d9ef>create</span> <span style=color:#66d9ef>table</span><span style=color:#f92672>/</span>view <span style=color:#960050;background-color:#1e0010>视图名字</span>; <span style=color:#75715e># 查看视图创建指令
</span><span style=color:#75715e></span><span style=color:#66d9ef>desc</span> <span style=color:#960050;background-color:#1e0010>视图名字</span>; <span style=color:#75715e># 查看视图结构
</span></code></pre></div></li>
<li>
<p>视图修改：更改视图逻辑</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>alter</span> view <span style=color:#960050;background-color:#1e0010>视图名</span> <span style=color:#66d9ef>as</span> <span style=color:#960050;background-color:#1e0010>新的查询命令</span>;
<span style=color:#66d9ef>create</span> <span style=color:#66d9ef>or</span> <span style=color:#66d9ef>replace</span> view <span style=color:#960050;background-color:#1e0010>视图名</span> <span style=color:#66d9ef>as</span> <span style=color:#960050;background-color:#1e0010>新的查询命令</span> <span style=color:#75715e># 创建新的或者替换新的
</span></code></pre></div></li>
<li>
<p>删除视图</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>drop</span> view <span style=color:#960050;background-color:#1e0010>视图名</span>;
</code></pre></div></li>
</ul>
<h4 id=视图的数据操作>视图的数据操作<a hidden class=anchor aria-hidden=true href=#视图的数据操作>#</a></h4>
<ul>
<li>
<p>视图所有的数据操作都是最终对基表的数据操作</p>
</li>
<li>
<p>视图操作条件</p>
<ul>
<li>
<p>多基表视图：不允许操作</p>
</li>
<li>
<p>单基表视图：允许增删改</p>
<ul>
<li>新增条件：视图的字段必须包含基表中所有不允许为空的字段</li>
</ul>
</li>
<li>
<p><code>with check option</code>：操作检查规则</p>
<ul>
<li>默认不需要这个规则（创建视图时指定）：视图操作只要满足前面上述条件即可</li>
<li>增加此规则：视图的数据操作后，必须要保证该视图还能把通过视图操作的数据查出来（否则失败）</li>
</ul>
</li>
</ul>
<h5 id=示例-7>示例<a hidden class=anchor aria-hidden=true href=#示例-7>#</a></h5>
</li>
</ul>
<ol>
<li>
<p>增加一个单表视图和多表视图</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>create</span> view v_student_1 <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>select</span> s_id,s_name <span style=color:#66d9ef>from</span> t1;
<span style=color:#66d9ef>create</span> view v_student_2 <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>select</span> s.<span style=color:#f92672>*</span>,c.c_name <span style=color:#66d9ef>from</span> t1 s <span style=color:#66d9ef>left</span> <span style=color:#66d9ef>join</span> t2 c <span style=color:#66d9ef>using</span>(c_id);
<span style=color:#66d9ef>create</span> <span style=color:#66d9ef>or</span> <span style=color:#66d9ef>replace</span> view v_student_3 <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> t1 <span style=color:#66d9ef>where</span> c_id <span style=color:#66d9ef>is</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>with</span> <span style=color:#66d9ef>check</span> <span style=color:#66d9ef>option</span>;
</code></pre></div></li>
<li>
<p>新增数据</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> v_student_1 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;student7&#39;</span>); <span style=color:#75715e># 正确：视图包含所有必有字段
</span><span style=color:#75715e></span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> v_student_2 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;student8&#39;</span>,<span style=color:#66d9ef>null</span>,<span style=color:#66d9ef>null</span>) <span style=color:#75715e># 错误：不可插入
</span><span style=color:#75715e></span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> v_student_3 <span style=color:#66d9ef>values</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;student8&#39;</span>,<span style=color:#66d9ef>null</span>) <span style=color:#75715e># 错误：check option，因为第三个字段c_id为null,不符合视图筛选条件，查不出来
</span><span style=color:#75715e></span><span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> v_student_3 <span style=color:#a6e22e>valeus</span>(<span style=color:#66d9ef>null</span>,<span style=color:#e6db74>&#39;student9&#39;</span>,<span style=color:#ae81ff>1</span>) <span style=color:#75715e># 正确
</span></code></pre></div></li>
<li>
<p>更新数据</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>update</span> v_student_1 <span style=color:#66d9ef>set</span> s_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;boy&#39;</span> <span style=color:#66d9ef>where</span> s_id <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>;
<span style=color:#66d9ef>update</span> v_student_2 <span style=color:#66d9ef>set</span> s_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;boy&#39;</span> <span style=color:#66d9ef>where</span> s_id <span style=color:#f92672>=</span> <span style=color:#ae81ff>7</span>; <span style=color:#75715e># 错误：不可修改 
</span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> v_student_3 <span style=color:#66d9ef>set</span> c_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span> <span style=color:#66d9ef>where</span> s_id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e># 错误：check option，修改后c_id为null，变得不符合视图筛选条件
</span><span style=color:#75715e></span><span style=color:#66d9ef>update</span> v_student_3 <span style=color:#66d9ef>set</span> s_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;boy&#39;</span> <span style=color:#66d9ef>where</span> s_id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</code></pre></div></li>
<li>
<p>删除数据</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>delete</span> <span style=color:#66d9ef>from</span> v_student_1 <span style=color:#66d9ef>where</span> s_id <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
<span style=color:#66d9ef>delete</span> <span style=color:#66d9ef>from</span> v_student_2 <span style=color:#66d9ef>where</span> s_id <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>; <span style=color:#75715e># 错误：不可修改
</span><span style=color:#75715e></span><span style=color:#66d9ef>delete</span> <span style=color:#66d9ef>from</span> v_student_3 <span style=color:#66d9ef>where</span> s_id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e># 可以删除，check option不影响删除操作
</span></code></pre></div></li>
</ol>
<h4 id=视图算法>视图算法<a hidden class=anchor aria-hidden=true href=#视图算法>#</a></h4>
<ul>
<li>
<p>视图在执行过程中对于内部的<code>select</code>指令的处理方式</p>
</li>
<li>
<p>视图算法在创建视图时指定</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>create</span> ALGORITHM <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>算法</span> view <span style=color:#960050;background-color:#1e0010>视图名字</span> <span style=color:#66d9ef>as</span> select指令;
</code></pre></div></li>
<li>
<p>视图算法一共有三种</p>
<ul>
<li><code>undefined</code>：默认的，未定义算法，即系统自动选择算法</li>
<li><code>merge</code>：合并算法，就是将视图外部查询语句跟视图内部select语句合并执行，效率高（系统优先选择）</li>
<li><code>temptable</code>：临时表算法，即系统将视图的select语句查出来先得出一张临时表，然后外部再查询（temptable算法视图不允许写操作）</li>
</ul>
</li>
</ul>
<h3 id=数据备份与还原>数据备份与还原<a hidden class=anchor aria-hidden=true href=#数据备份与还原>#</a></h3>
<h4 id=表数据备份>表数据备份<a hidden class=anchor aria-hidden=true href=#表数据备份>#</a></h4>
<ul>
<li>单独针对表里的<strong>数据部分</strong>进行备份（数据导出）</li>
<li>将数据从表中查出，按照一定格式存储到外部文件
<ul>
<li>字段格式化：<code>fields</code>
<ul>
<li><code>terminated by</code>：字段数据结束后使用的符号，默认是空格</li>
<li><code>enclosed by</code>：字段数据包裹，默认什么都没有</li>
<li><code>escaped by</code>：特殊字符的处理，默认是转义</li>
</ul>
</li>
<li>行格式化：<code>lines</code>
<ul>
<li><code>terminated by</code>：行结束符号，默认是\n，自动换行</li>
<li><code>starting by</code>：行开始符号，默认没有</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>select</span> <span style=color:#960050;background-color:#1e0010>字段列表</span><span style=color:#f92672>|*</span> <span style=color:#66d9ef>into</span> <span style=color:#66d9ef>outfile</span> <span style=color:#e6db74>&#39;外部文件路径&#39;</span>
	[fields <span style=color:#66d9ef>terminated</span> <span style=color:#66d9ef>by</span> <span style=color:#960050;background-color:#1e0010>格式</span> <span style=color:#66d9ef>enclosed</span> <span style=color:#66d9ef>by</span> <span style=color:#960050;background-color:#1e0010>格式</span>]
	[<span style=color:#66d9ef>lines</span> <span style=color:#66d9ef>terminated</span> <span style=color:#66d9ef>by</span> <span style=color:#960050;background-color:#1e0010>格式</span> <span style=color:#66d9ef>starting</span> <span style=color:#66d9ef>by</span> <span style=color:#960050;background-color:#1e0010>格式</span>]
<span style=color:#66d9ef>from</span> <span style=color:#960050;background-color:#1e0010>数据表</span>;
</code></pre></div><ul>
<li>表数据备份不限定数据的来源是一张表还是多张表（可以连表）</li>
</ul>
<h4 id=表数据还原>表数据还原<a hidden class=anchor aria-hidden=true href=#表数据还原>#</a></h4>
<ul>
<li>将<strong>符合数据结构</strong>的数据导入到数据表中（数据导入）</li>
<li>将一定格式的数据按照一定的解析方式解析成符合表字段格式的数据导入到数据表
<ul>
<li>字段处理</li>
<li>行处理</li>
</ul>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=color:#66d9ef>load</span> data <span style=color:#66d9ef>infile</span> <span style=color:#e6db74>&#39;数据文件所在路径&#39;</span> <span style=color:#66d9ef>into</span> <span style=color:#66d9ef>table</span> <span style=color:#960050;background-color:#1e0010>表名</span>
	[fields <span style=color:#66d9ef>terminated</span> <span style=color:#66d9ef>by</span> <span style=color:#960050;background-color:#1e0010>格式</span> <span style=color:#66d9ef>enclosed</span> <span style=color:#66d9ef>by</span> <span style=color:#960050;background-color:#1e0010>格式</span>]
	[<span style=color:#66d9ef>lines</span> <span style=color:#66d9ef>terminated</span> <span style=color:#66d9ef>by</span> <span style=color:#960050;background-color:#1e0010>格式</span> <span style=color:#66d9ef>starting</span> <span style=color:#66d9ef>by</span> <span style=color:#960050;background-color:#1e0010>格式</span>]
	[(<span style=color:#960050;background-color:#1e0010>字段列表</span>)];
</code></pre></div><ul>
<li>数据文件来源
<ul>
<li>表数据备份的数据文件</li>
<li>外部获取或者制作的符合格式的数据</li>
</ul>
</li>
</ul>
<h4 id=文件备份>文件备份<a hidden class=anchor aria-hidden=true href=#文件备份>#</a></h4>
<ul>
<li>直接对数据表进行文件保留，属于物理备份</li>
<li>文件备份操作简单，直接将数据表（或者数据库文件夹）进行保存迁移</li>
<li>MySQL中不同表存储引擎产生的文件不一致，保存手段也不一致
<ul>
<li>InnoDB：表结构文件再ibd文件夹中，数据和索引存储在外部统一的ibdata文件夹中</li>
<li>MyIsam：每张表的数据、结构和索引都是独立文件，直接找到三个文件迁移即可</li>
</ul>
</li>
</ul>
<h4 id=文件还原>文件还原<a hidden class=anchor aria-hidden=true href=#文件还原>#</a></h4>
<ul>
<li>利用备份的文件，替换出现问题的文件，还原到备份前的良好状态</li>
<li>直接将备份文件放到相应位置即可</li>
<li>文件还原影响
<ul>
<li>InnoDB：单表结构，整库数据，知识和整库备份还原，否则会影响其他InnoDB存储表</li>
<li>MyIsam：单表备份，单表还原，不影响其他任何数据</li>
</ul>
</li>
</ul>
<p>​</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://www.niuwx.cn/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/>数据库</a></li>
<li><a href=https://www.niuwx.cn/tags/mysql/>MySQL</a></li>
<li><a href=https://www.niuwx.cn/tags/%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F/>外键约束</a></li>
<li><a href=https://www.niuwx.cn/tags/%E4%BA%8B%E5%8A%A1%E5%AE%89%E5%85%A8/>事务安全</a></li>
<li><a href=https://www.niuwx.cn/tags/%E9%A2%84%E5%A4%84%E7%90%86/>预处理</a></li>
<li><a href=https://www.niuwx.cn/tags/%E8%A7%86%E5%9B%BE/>视图</a></li>
<li><a href=https://www.niuwx.cn/tags/%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%98%E5%8E%9F/>数据备份与还原</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://www.niuwx.cn/posts/golang/golang%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>
<span class=title>« Prev Page</span>
<br>
<span>Golang学习笔记</span>
</a>
<a class=next href=https://www.niuwx.cn/posts/mysql/mysql%E5%A4%9A%E8%A1%A8%E6%93%8D%E4%BD%9C/>
<span class=title>Next Page »</span>
<br>
<span>MySQL多表操作</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share MySQL安全管理 on twitter" href="https://twitter.com/intent/tweet/?text=MySQL%e5%ae%89%e5%85%a8%e7%ae%a1%e7%90%86&url=https%3a%2f%2fwww.niuwx.cn%2fposts%2fmysql%2fmysql%25E5%25AE%2589%25E5%2585%25A8%25E7%25AE%25A1%25E7%2590%2586%2f&hashtags=%e6%95%b0%e6%8d%ae%e5%ba%93%2cMySQL%2c%e5%a4%96%e9%94%ae%e7%ba%a6%e6%9d%9f%2c%e4%ba%8b%e5%8a%a1%e5%ae%89%e5%85%a8%2c%e9%a2%84%e5%a4%84%e7%90%86%2c%e8%a7%86%e5%9b%be%2c%e6%95%b0%e6%8d%ae%e5%a4%87%e4%bb%bd%e4%b8%8e%e8%bf%98%e5%8e%9f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share MySQL安全管理 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.niuwx.cn%2fposts%2fmysql%2fmysql%25E5%25AE%2589%25E5%2585%25A8%25E7%25AE%25A1%25E7%2590%2586%2f&title=MySQL%e5%ae%89%e5%85%a8%e7%ae%a1%e7%90%86&summary=MySQL%e5%ae%89%e5%85%a8%e7%ae%a1%e7%90%86&source=https%3a%2f%2fwww.niuwx.cn%2fposts%2fmysql%2fmysql%25E5%25AE%2589%25E5%2585%25A8%25E7%25AE%25A1%25E7%2590%2586%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share MySQL安全管理 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.niuwx.cn%2fposts%2fmysql%2fmysql%25E5%25AE%2589%25E5%2585%25A8%25E7%25AE%25A1%25E7%2590%2586%2f&title=MySQL%e5%ae%89%e5%85%a8%e7%ae%a1%e7%90%86"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share MySQL安全管理 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.niuwx.cn%2fposts%2fmysql%2fmysql%25E5%25AE%2589%25E5%2585%25A8%25E7%25AE%25A1%25E7%2590%2586%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share MySQL安全管理 on whatsapp" href="https://api.whatsapp.com/send?text=MySQL%e5%ae%89%e5%85%a8%e7%ae%a1%e7%90%86%20-%20https%3a%2f%2fwww.niuwx.cn%2fposts%2fmysql%2fmysql%25E5%25AE%2589%25E5%2585%25A8%25E7%25AE%25A1%25E7%2590%2586%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share MySQL安全管理 on telegram" href="https://telegram.me/share/url?text=MySQL%e5%ae%89%e5%85%a8%e7%ae%a1%e7%90%86&url=https%3a%2f%2fwww.niuwx.cn%2fposts%2fmysql%2fmysql%25E5%25AE%2589%25E5%2585%25A8%25E7%25AE%25A1%25E7%2590%2586%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
<div class=post-comments><script src=https://utteranc.es/client.js repo=28251536/28251536.github.io issue-term=title label=Comment theme=github-light crossorigin=anonymous async></script>
</div>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://www.niuwx.cn/>Ther's Blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>