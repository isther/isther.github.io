<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Linux C之进程 | Ther's Blog</title>
<meta name=keywords content="C,Linux,线程,进程,管道">
<meta name=description content="初识进程和线程
认识进程
在Linux系统中，每一个进程都有自己的ID，就如同人的身份证一样。Linux中有一个数据类型pid_t，它定义了进程的ID。">
<meta name=author content="Ther">
<link rel=canonical href=https://www.niuwx.cn/>
<meta name=google-site-verification content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.83c4eb6d61e6a4176992e4a4ce8786fc30bd40032ba8663ec5d11e285a965766.css integrity="sha256-g8TrbWHmpBdpkuSkzoeG/DC9QAMrqGY+xdEeKFqWV2Y=" rel="preload stylesheet" as=style>
<link rel=icon href=https://www.niuwx.cn/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://www.niuwx.cn/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=https://www.niuwx.cn/favicon.ico>
<link rel=apple-touch-icon href=https://www.niuwx.cn/favicon.ico>
<link rel=mask-icon href=https://www.niuwx.cn/favicon.ico>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.1">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:!0},{left:'$',right:'$',display:!1},{left:'\\(',right:'\\)',display:!1},{left:'\\[',right:'\\]',display:!1}],throwOnError:!1})})</script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script><meta property="og:title" content="Linux C之进程">
<meta property="og:description" content="初识进程和线程
认识进程
在Linux系统中，每一个进程都有自己的ID，就如同人的身份证一样。Linux中有一个数据类型pid_t，它定义了进程的ID。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.niuwx.cn/posts/linux/linux_c_1/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-01-30T21:33:51+08:00">
<meta property="article:modified_time" content="2022-01-30T21:33:51+08:00"><meta property="og:site_name" content="Ther's Blog">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Linux C之进程">
<meta name=twitter:description content="初识进程和线程
认识进程
在Linux系统中，每一个进程都有自己的ID，就如同人的身份证一样。Linux中有一个数据类型pid_t，它定义了进程的ID。">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.niuwx.cn/posts/"},{"@type":"ListItem","position":2,"name":"Linux","item":"https://www.niuwx.cn/posts/linux/"},{"@type":"ListItem","position":3,"name":"Linux C之进程","item":"https://www.niuwx.cn/posts/linux/linux_c_1/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Linux C之进程","name":"Linux C之进程","description":"初识进程和线程 认识进程 在Linux系统中，每一个进程都有自己的ID，就如同人的身份证一样。Linux中有一个数据类型pid_t，它定义了进程的ID。\n","keywords":["C","Linux","线程","进程","管道"],"articleBody":"初识进程和线程 认识进程 在Linux系统中，每一个进程都有自己的ID，就如同人的身份证一样。Linux中有一个数据类型pid_t，它定义了进程的ID。\nfork() 首先看下如何创建新的进程，这里需要用到fork()函数，其返回值类型为pid_t。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  #include #include #include #include void get_pid() { pid_t pid = fork(); if (pid  0) { printf(\"fork error\\n\"); exit(1); } else if (pid  0) { printf(\"parent: the pid is %d\\n\", pid); while (1) ; } else { printf(\"child: this pid is %d\\n\", pid); while (1) ; } } int main() { get_pid(); return 0; }   执行结果：\n1 2  parent: the pid is 20580 child: this pid is 0   执行结果中有两条输出，分别是父进程和子进程。\n通过命令行执行htop找到对应的进程，我们可以发现父子进程都有其特定的pid，那么为什么程序会输出0呢？\n实际上，在调用fork()函数之后，程序创建了一个子进程，程序本身成为了父进程。\n而fork()的返回值代表什么意义呢？\n 负数：创建子进程失败。 零：在子进程中，fork()返回0 正数：在父进程中，fork()返回子进程的pid  至此，以上的疑惑也就迎刃而解了，在这里介绍两个进程相关的函数：\n getpid()：获取当前进程的pid getppid()：获取当前进程的父进程的pid  接下来再看这段程序：\n增加了一个全局变量和一个函数内部的局部变量。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  #include #include #include #include int global_var = 2; void get_pid() { pid_t pid = fork(); int var = 5; if (pid  0) { printf(\"fork error\\n\"); exit(1); } else if (pid  0) { printf(\"parent: this pid is %d, global_var = %d, var = %d\\n\", pid, global_var, var); exit(0); } else { global_var--; var++; printf(\"child: this pid is %d, global_var = %d, var = %d\\n\", pid, global_var, var); exit(0); } } int main() { get_pid(); return 0; }   执行结果：\n1 2  parent: this pid is 22982, global_var = 2, var = 5 child: this pid is 0, global_var = 1, var = 6   在子进程中，global_var与var分别执行的加减操作，但是在父进程中，这两个变量的值都未发生改变，这是为什么呢？\n原因在于：执行fork()函数时，子进程复制了父进程的所有资源，包括内存等等。因此，父子进程属于不同的内存空间，那么子进程中变量发生改变时，父进程中的变量必然不会改变。\nvfork() 除了fork()函数，还有一个vfork()函数，同样是系统调用函数，用来创建子进程。但是这二者是有区别的：vfork()函数在创建子进程时，父子进程共享地址空间。因此子进程中修改的全局变量在父进程中也会被修改。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  #include #include #include #include int global_var = 2; void get_pid() { pid_t pid = vfork(); int var = 5; printf(\"pid = %d\\n\", getpid()); printf(\"global_var = %d, var = %d\\n\", global_var, var); if (pid  0) { printf(\"fork error\\n\"); exit(1); } else if (pid  0) { printf(\"parent: this pid is %d, global_var = %d, var = %d\\n\", pid, global_var, var); exit(0); } else { global_var--; var++; printf(\"child: this pid is %d, global_var = %d, var = %d\\n\", pid, global_var, var); exit(0); } } int main() { get_pid(); return 0; }   执行结果：\n1 2 3 4 5 6  pid = 25371 global_var = 2, var = 5 child: this pid is 0, global_var = 1, var = 6 pid = 25370 global_var = 1, var = 5 parent: this pid is 25371, global_var = 1, var = 5   execv() 在fork()与vfork()中，子进程与父进程都运行同样的代码。如果需要子进程执行不同的操作，就要用到execv()函数了\n1 2 3 4 5 6 7  //parent.c #include #include int main(int argc, char* argv[]) { execv(\"child\", argv); return 0; }   1 2 3 4 5 6 7 8 9 10  //child.c #include  int main(int argc, char* argv[]) { puts(\"welcome!\"); for (int i = 0; i  argc; i++) { puts(argv[i]); } return 0; }   分别编译两个c文件，执行parent.c编译得到的可执行文件：./parent 1 2 3。\n执行结果：\n1 2 3 4 5  welcome! ./parent 1 2 3   进程等待 进程等待就是同步父子进程。可以通过调用wait()函数来实现。\nwait()函数的工作原理是首先判断子进程是否存在， 如果创建失败，子进程不存在，那么就直接退出进程，并提示相关错误信息。如果创建成功，wait()函数将父进程挂起，知道子进程结束，并返回结束的状态和最后结束的子进程的pid。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42  #include #include #include #include #include  void exit_s(int status) { if (WIFEXITED(status)) { printf(\"normal exist, status = %d\\n\", WEXITSTATUS(status)); } else if (WIFSIGNALED(status)) { printf(\"signal exit! status = %d\\n\", WTERMSIG(status)); } } void wait_test() { pid_t pid_a; int status; int ret; pid_a = fork(); if (pid_a  0) { printf(\"child process error\\n\"); exit(0); } else if (pid_a  0) { printf(\"the pid of parent is %d\\n\", getpid()); printf(\"wait for child ...\\n\"); int pid_child = wait(\u0026status); if (pid_child  0) { printf(\"i catch a child process with pid of %d\\n\", pid_child); } exit_s(status); } else { printf(\"the pid of child is %d\\n\", getpid()); sleep(3); exit(2); } } int main() { wait_test(); return 0; }   执行结果：\n1 2 3 4 5  the pid of parent is 46045 wait for child ... the pid of child is 46046 i catch a child process with pid of 46046 normal exist, status = 2   在子进程中调用sleep()函数，睡眠3秒，只有子进程完成睡眠，才能正常退出并被父进程捕捉到。在此期间父进程会继续等待下去。在wait函数中会将子进程的状态保存到status中。\n在处理status的exit_s()函数中，调用了几个宏：\n WIFEXITED：当子进程正常退出时，返回真值 WEXITSTATUS：返回子进程正常退出时的状态 WTERMSIG：用于子进程被信号终止的情况  如果在程序执行过程中子进程异常退出，会是怎样的情况呢？\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44  #include #include #include #include #include  void exit_s(int status) { if (WIFEXITED(status)) { printf(\"normal exist, status = %d\\n\", WEXITSTATUS(status)); } else if (WIFSIGNALED(status)) { printf(\"signal exit! status = %d\\n\", WTERMSIG(status)); } } void wait_test() { pid_t pid_a; int status; int ret; pid_a = fork(); if (pid_a  0) { printf(\"child process error\\n\"); exit(0); } else if (pid_a  0) { printf(\"the pid of parent is %d\\n\", getpid()); printf(\"wait child ...\\n\"); int pid_child = wait(\u0026status); if (pid_child  0) { printf(\"i catch a child process with pid of %d\\n\", pid_child); } exit_s(status); } else { printf(\"the pid of child is %d\\n\", getpid()); // sleep(3);  pid_t pid = getpid(); kill(pid, 9); exit(2); } } int main() { wait_test(); return 0; }   执行结果：\n1 2 3 4 5  the pid of parent is 46749 wait child ... the pid of child is 46750 i catch a child process with pid of 46750 signal exit! status = 9   线程 需要先了解一下进程和线程的区别：\n 进程是资源分配的最小单位，每个进程都占有独立内存空间。 线程是程序执行的最小单位，多个线程共享同一个内存空间。 一个进程由几个线程组成，线程与同属一个进程的其他线程共享当前进程拥有的全部资源。  那么，线程有哪些优势呢？\n 线程不需要额外的内存申请 线程共享进程内的数据，访问数据方便，而进程则需要通过通信的方式进行。  在linux下，进程使用ps命令查看，线程则通过top命令来查看。还可以通过top -p pid来查看某个进程内的线程。\n先看一个创建进程的例子：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  #include #include #include #include  void *thread1(void) { int i; for (int i = 0; i  5; i++) { printf(\"this is the first thread\\n\"); sleep(1); } } void *thread2(void) { int i; for (int i = 0; i  5; i++) { printf(\"this is the second thread\\n\"); sleep(1); } } int main() { int ret = 0; pthread_t id1, id2; pthread_create(\u0026id1, NULL, (void *)thread1, NULL); pthread_create(\u0026id2, NULL, (void *)thread2, NULL); pthread_join(id1, NULL); pthread_join(id2, NULL); return 0; }   在这里，thread1和thread2两个函数分别属于不同的线程。\npthread_t是线程的id。\npthread_create()是创建线程的函数，参数分别是：参数id，线程属性，线程运行函数的起始地址，运行函数的参数。\n注意，由于pthread并非Linux系统的默认库，而是POSIX线程库，所以在编译的时候需要加上-lpthread来显式链接该库：gcc -g main.c -lpthread。\n执行结果：\n1 2 3 4 5 6 7 8 9 10  this is the first thread this is the second thread this is the first thread this is the second thread this is the first thread this is the second thread this is the first thread this is the second thread this is the first thread this is the second thread   进程间通信 进程间的通信包括管道、共享内存、信号量通信、消息队列、套借口(socket)和全双工管道通信。\n管道 管道顾名思义，就如同水管一样，当水从水管的一端流向另一端的时候，水流是单方向的。某一时刻只能从单方向传递数据，不能双向传递，这种就是半双工模式。半双工模式只能一端写数据，一端读数据，先来看一个半双工的例子：\n 在父进程中通过pipe()函数创建一个管道，得到管道读端ppe[0]，写端ppe[1]。 在父进程中调用fork()产生一个子进程 在子进程中关闭ppe[0]，往ppe[1]中写入数据，在父进程中关闭ppe[1]，从ppe[0]中读取数据。  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38  #include #include #include #include #include  int pipe_test() { int ppe[2]; if (pipe(ppe) == -1) { perror(\"not create a new process!\\n\"); return 1; } int pid = fork(); if (pid == 0) { close(ppe[0]); printf(\"child process send message\\n\"); char *message = \"happy new year!\\n\"; write(ppe[1], message, strlen(message)); } else { close(ppe[1]); sleep(2); printf(\"parent process receive message\\n\"); char message[100]; int line = read(ppe[0], message, 100); write(STDOUT_FILENO, message, line); wait(NULL); exit(0); } return 0; } int main() { pipe_test(); return 0; }   执行结果：\n1 2 3  child process send message parent process receive message happy new year!   上面这个例子演示了单向通信，如果我们需要双向通信：父进程在读的同时也给子进程写。要实现这样的功能，就必须建立两个管道：一个管道从父进程流向子进程，一个管道从子进程流向父进程。\n代码如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53  #include #include #include #include #include  int pipe_test() { int ppea[2], ppeb[2]; if (pipe(ppea) == -1 || pipe(ppeb) == -1) { perror(\"not create a new process!\\n\"); return 1; } int pid = fork(); if (pid  0) { perror(\"not create a new process !\"); return 1; } else if (pid == 0) { close(ppea[0]); printf(\"child process send message\\n\"); char *message_send = \"happy new year!\\n\"; write(ppea[1], message_send, strlen(message_send)); sleep(2); close(ppeb[1]); printf(\"child process receive message\\n\"); char message_receive[100]; int line = read(ppeb[0], message_receive, 100); write(STDOUT_FILENO, message_receive, line); exit(0); } else { close(ppea[1]); sleep(2); printf(\"parent process receive message\\n\"); char message_receive[100]; int line = read(ppea[0], message_receive, 100); write(STDOUT_FILENO, message_receive, line); close(ppeb[0]); printf(\"parent process send message\\n\"); char *message_send = \"happy new year my child!\\n\"; write(ppeb[1], message_send, strlen(message_send)); exit(0); } return 0; } int main() { pipe_test(); return 0; }   执行结果：\n1 2 3 4 5 6  child process send message parent process receive message happy new year! parent process send message child process receive message happy new year my child!   命令管道 上个部分介绍了管道，然而管道只能在有关联的进程中进行通信，也就是父子进程之间。那如果不相关的两个进程间也需要进行通信，这里就需要用到命令管道了，通常称为FIFO。通过这个名称可以知道命令管道遵循先进先出的原则，与数据结构中的队列类似。\n创建一个命令管道有两种方法：\n 通过shell命令创建 通过函数创建命名管道  shell命令创建命名管道  首先通过mkfifo创建一个管道文件test：mkfifo test 通过cat ./test查看，此时，管道文件中没有任何数据 打开另一个终端，向FIFO中写入数据：echo \"hello fifo\"  ./test 再次通过cat ./test查看，将会得到之前写入的数据。  函数创建命名管道 下面通过c来实现命令管道：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  //write.c #include #include #include #include #include  int mkfifo_write() { int ppe = open(\"./fifo\", O_RDWR); printf(\"write the message:\\n\"); char* message = \"hello world\\n\"; write(ppe, message, strlen(message)); close(ppe); } int main() { mkfifo_write(); return 0; }   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  //read.c #include #include #include #include  int mkfifo_read() { char message[100]; int ppe = open(\"./fifo\", O_RDWR); printf(\"read the message:\\n\"); int line = read(ppe, message, 100); close(ppe); write(STDOUT_FILENO, message, line); } int main(int argc, char* argv[]) { mkfifo_read(); return 0; }   编译后，开启两个终端，一个终端先执行./read，另一个终端再执行./write，第一个终端中就会显示发出的信息。\n","wordCount":"1562","inLanguage":"en","datePublished":"2022-01-30T21:33:51+08:00","dateModified":"2022-01-30T21:33:51+08:00","author":{"@type":"Person","name":"Ther"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.niuwx.cn/posts/linux/linux_c_1/"},"publisher":{"@type":"Organization","name":"Ther's Blog","logo":{"@type":"ImageObject","url":"https://www.niuwx.cn/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://www.niuwx.cn/ accesskey=h title="Ther's Blog (Alt + H)">Ther's Blog</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://www.niuwx.cn/ title=Home>
<span>Home</span>
</a>
</li>
<li>
<a href=https://www.niuwx.cn/archive title=Archives>
<span>Archives</span>
</a>
</li>
<li>
<a href=https://www.niuwx.cn/categories title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://www.niuwx.cn/tags title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://www.niuwx.cn/friends title=Friends>
<span>Friends</span>
</a>
</li>
<li>
<a href=https://www.niuwx.cn/search title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://www.niuwx.cn/>Home</a>&nbsp;»&nbsp;<a href=https://www.niuwx.cn/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://www.niuwx.cn/posts/linux/>Linux</a></div>
<h1 class=post-title>
Linux C之进程
</h1>
<div class=post-meta>January 30, 2022&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Ther&nbsp;|&nbsp;<a href=https://github.com/isther/isther.github.io/tree/master/content/posts/linux/linux_c_1.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#%e5%88%9d%e8%af%86%e8%bf%9b%e7%a8%8b%e5%92%8c%e7%ba%bf%e7%a8%8b aria-label=初识进程和线程>初识进程和线程</a><ul>
<li>
<a href=#%e8%ae%a4%e8%af%86%e8%bf%9b%e7%a8%8b aria-label=认识进程>认识进程</a><ul>
<li>
<a href=#fork aria-label=fork()>fork()</a></li>
<li>
<a href=#vfork aria-label=vfork()>vfork()</a></li>
<li>
<a href=#execv aria-label=execv()>execv()</a></li></ul>
</li>
<li>
<a href=#%e8%bf%9b%e7%a8%8b%e7%ad%89%e5%be%85 aria-label=进程等待>进程等待</a></li>
<li>
<a href=#%e7%ba%bf%e7%a8%8b aria-label=线程>线程</a></li></ul>
</li>
<li>
<a href=#%e8%bf%9b%e7%a8%8b%e9%97%b4%e9%80%9a%e4%bf%a1 aria-label=进程间通信>进程间通信</a><ul>
<li>
<a href=#%e7%ae%a1%e9%81%93 aria-label=管道>管道</a></li>
<li>
<a href=#%e5%91%bd%e4%bb%a4%e7%ae%a1%e9%81%93 aria-label=命令管道>命令管道</a><ul>
<li>
<a href=#shell%e5%91%bd%e4%bb%a4%e5%88%9b%e5%bb%ba%e5%91%bd%e5%90%8d%e7%ae%a1%e9%81%93 aria-label=shell命令创建命名管道>shell命令创建命名管道</a></li>
<li>
<a href=#%e5%87%bd%e6%95%b0%e5%88%9b%e5%bb%ba%e5%91%bd%e5%90%8d%e7%ae%a1%e9%81%93 aria-label=函数创建命名管道>函数创建命名管道</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h2 id=初识进程和线程>初识进程和线程<a hidden class=anchor aria-hidden=true href=#初识进程和线程>#</a></h2>
<h3 id=认识进程>认识进程<a hidden class=anchor aria-hidden=true href=#认识进程>#</a></h3>
<p>在Linux系统中，每一个进程都有自己的ID，就如同人的身份证一样。Linux中有一个数据类型pid_t，它定义了进程的ID。</p>
<h4 id=fork>fork()<a hidden class=anchor aria-hidden=true href=#fork>#</a></h4>
<p>首先看下如何创建新的进程，这里需要用到<code>fork()</code>函数，其返回值类型为<code>pid_t</code>。</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>get_pid</span>() {
    pid_t pid <span style=color:#f92672>=</span> fork();
    <span style=color:#66d9ef>if</span> (pid <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
        printf(<span style=color:#e6db74>&#34;fork error</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        exit(<span style=color:#ae81ff>1</span>);
    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (pid <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
        printf(<span style=color:#e6db74>&#34;parent: the pid is %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, pid);
        <span style=color:#66d9ef>while</span> (<span style=color:#ae81ff>1</span>)
            ;
    } <span style=color:#66d9ef>else</span> {
        printf(<span style=color:#e6db74>&#34;child: this pid is %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, pid);
        <span style=color:#66d9ef>while</span> (<span style=color:#ae81ff>1</span>)
            ;
    }
}
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
    get_pid();
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>parent: the pid is <span style=color:#ae81ff>20580</span>
child: this pid is <span style=color:#ae81ff>0</span>
</code></pre></td></tr></table>
</div>
</div><p>执行结果中有两条输出，分别是父进程和子进程。</p>
<p>通过命令行执行<code>htop</code>找到对应的进程，我们可以发现父子进程都有其特定的pid，那么为什么程序会输出0呢？</p>
<p><img loading=lazy src=/htop.png alt=htop.png>
</p>
<p>实际上，在调用<code>fork()</code>函数之后，程序创建了一个子进程，程序本身成为了父进程。</p>
<p>而<code>fork()</code>的返回值代表什么意义呢？</p>
<ul>
<li>负数：创建子进程失败。</li>
<li>零：在子进程中，<code>fork()</code>返回0</li>
<li>正数：在父进程中，<code>fork()</code>返回子进程的pid</li>
</ul>
<p>至此，以上的疑惑也就迎刃而解了，在这里介绍两个进程相关的函数：</p>
<ul>
<li><code>getpid()</code>：获取当前进程的pid</li>
<li><code>getppid()</code>：获取当前进程的父进程的pid</li>
</ul>
<p>接下来再看这段程序：</p>
<p>增加了一个全局变量和一个函数内部的局部变量。</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> global_var <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>get_pid</span>() {
    pid_t pid <span style=color:#f92672>=</span> fork();
    <span style=color:#66d9ef>int</span> var <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
    <span style=color:#66d9ef>if</span> (pid <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
        printf(<span style=color:#e6db74>&#34;fork error</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        exit(<span style=color:#ae81ff>1</span>);
    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (pid <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
        printf(<span style=color:#e6db74>&#34;parent: this pid is %d, global_var = %d, var = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, pid, global_var, var);
        exit(<span style=color:#ae81ff>0</span>);
    } <span style=color:#66d9ef>else</span> {
        global_var<span style=color:#f92672>--</span>;
        var<span style=color:#f92672>++</span>;
        printf(<span style=color:#e6db74>&#34;child: this pid is %d, global_var = %d, var = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, pid, global_var, var);

        exit(<span style=color:#ae81ff>0</span>);
    }
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
    get_pid();
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>parent: this pid is 22982, global_var <span style=color:#f92672>=</span> 2, var <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
child: this pid is 0, global_var <span style=color:#f92672>=</span> 1, var <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>
</code></pre></td></tr></table>
</div>
</div><p>在子进程中，<code>global_var</code>与<code>var</code>分别执行的加减操作，但是在父进程中，这两个变量的值都未发生改变，这是为什么呢？</p>
<p>原因在于：执行<code>fork()</code>函数时，子进程复制了父进程的所有资源，包括内存等等。因此，父子进程属于不同的内存空间，那么子进程中变量发生改变时，父进程中的变量必然不会改变。</p>
<h4 id=vfork>vfork()<a hidden class=anchor aria-hidden=true href=#vfork>#</a></h4>
<p>除了<code>fork()</code>函数，还有一个<code>vfork()</code>函数，同样是系统调用函数，用来创建子进程。但是这二者是有区别的：<code>vfork()</code>函数在创建子进程时，父子进程共享地址空间。因此子进程中修改的全局变量在父进程中也会被修改。</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> global_var <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>get_pid</span>() {
    pid_t pid <span style=color:#f92672>=</span> vfork();
    <span style=color:#66d9ef>int</span> var <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
    printf(<span style=color:#e6db74>&#34;pid = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, getpid());
    printf(<span style=color:#e6db74>&#34;global_var = %d, var = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, global_var, var);
    <span style=color:#66d9ef>if</span> (pid <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
        printf(<span style=color:#e6db74>&#34;fork error</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        exit(<span style=color:#ae81ff>1</span>);
    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (pid <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
        printf(<span style=color:#e6db74>&#34;parent: this pid is %d, global_var = %d, var = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, pid, global_var, var);
        exit(<span style=color:#ae81ff>0</span>);
    } <span style=color:#66d9ef>else</span> {
        global_var<span style=color:#f92672>--</span>;
        var<span style=color:#f92672>++</span>;
        printf(<span style=color:#e6db74>&#34;child: this pid is %d, global_var = %d, var = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, pid, global_var, var);
        exit(<span style=color:#ae81ff>0</span>);
    }
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
    get_pid();
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>pid <span style=color:#f92672>=</span> <span style=color:#ae81ff>25371</span>
global_var <span style=color:#f92672>=</span> 2, var <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
child: this pid is 0, global_var <span style=color:#f92672>=</span> 1, var <span style=color:#f92672>=</span> <span style=color:#ae81ff>6</span>
pid <span style=color:#f92672>=</span> <span style=color:#ae81ff>25370</span>
global_var <span style=color:#f92672>=</span> 1, var <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
parent: this pid is 25371, global_var <span style=color:#f92672>=</span> 1, var <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</code></pre></td></tr></table>
</div>
</div><h4 id=execv>execv()<a hidden class=anchor aria-hidden=true href=#execv>#</a></h4>
<p>在<code>fork()</code>与<code>vfork()</code>中，子进程与父进程都运行同样的代码。如果需要子进程执行不同的操作，就要用到<code>execv()</code>函数了</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>//parent.c
</span><span style=color:#75715e></span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> argv[]) {
    execv(<span style=color:#e6db74>&#34;child&#34;</span>, argv);
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>//child.c
</span><span style=color:#75715e></span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> argv[]) {
    puts(<span style=color:#e6db74>&#34;welcome!&#34;</span>);
    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> argc; i<span style=color:#f92672>++</span>) {
        puts(argv[i]);
    }
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></td></tr></table>
</div>
</div><p>分别编译两个c文件，执行<code>parent.c</code>编译得到的可执行文件：<code>./parent 1 2 3</code>。</p>
<p>执行结果：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>welcome!
./parent
<span style=color:#ae81ff>1</span>
<span style=color:#ae81ff>2</span>
<span style=color:#ae81ff>3</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=进程等待>进程等待<a hidden class=anchor aria-hidden=true href=#进程等待>#</a></h3>
<p>进程等待就是同步父子进程。可以通过调用<code>wait()</code>函数来实现。</p>
<p><code>wait()</code>函数的工作原理是首先判断子进程是否存在， 如果创建失败，子进程不存在，那么就直接退出进程，并提示相关错误信息。如果创建成功，<code>wait()</code>函数将父进程挂起，知道子进程结束，并返回结束的状态和最后结束的子进程的pid。</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;wait.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>exit_s</span>(<span style=color:#66d9ef>int</span> status) {
    <span style=color:#66d9ef>if</span> (WIFEXITED(status)) {
        printf(<span style=color:#e6db74>&#34;normal exist, status = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, WEXITSTATUS(status));
    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (WIFSIGNALED(status)) {
        printf(<span style=color:#e6db74>&#34;signal exit! status = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, WTERMSIG(status));
    }
}

<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>wait_test</span>() {
    pid_t pid_a;
    <span style=color:#66d9ef>int</span> status;
    <span style=color:#66d9ef>int</span> ret;

    pid_a <span style=color:#f92672>=</span> fork();
    <span style=color:#66d9ef>if</span> (pid_a <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
        printf(<span style=color:#e6db74>&#34;child process error</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        exit(<span style=color:#ae81ff>0</span>);
    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (pid_a <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
        printf(<span style=color:#e6db74>&#34;the pid of parent is %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, getpid());
        printf(<span style=color:#e6db74>&#34;wait for child ...</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        <span style=color:#66d9ef>int</span> pid_child <span style=color:#f92672>=</span> wait(<span style=color:#f92672>&amp;</span>status);
        <span style=color:#66d9ef>if</span> (pid_child <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
            printf(<span style=color:#e6db74>&#34;i catch a child process with pid of %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, pid_child);
        }
        exit_s(status);
    } <span style=color:#66d9ef>else</span> {
        printf(<span style=color:#e6db74>&#34;the pid of child is %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, getpid());
        sleep(<span style=color:#ae81ff>3</span>);
        exit(<span style=color:#ae81ff>2</span>);
    }
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
    wait_test();
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>the pid of parent is <span style=color:#ae81ff>46045</span>
wait <span style=color:#66d9ef>for</span> child ...
the pid of child is <span style=color:#ae81ff>46046</span>
i catch a child process with pid of <span style=color:#ae81ff>46046</span>
normal exist, status <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</code></pre></td></tr></table>
</div>
</div><p>在子进程中调用<code>sleep()</code>函数，睡眠3秒，只有子进程完成睡眠，才能正常退出并被父进程捕捉到。在此期间父进程会继续等待下去。在wait函数中会将子进程的状态保存到<code>status</code>中。</p>
<p>在处理<code>status</code>的<code>exit_s()</code>函数中，调用了几个宏：</p>
<ul>
<li><code>WIFEXITED</code>：当子进程正常退出时，返回真值</li>
<li><code>WEXITSTATUS</code>：返回子进程正常退出时的状态</li>
<li><code>WTERMSIG</code>：用于子进程被信号终止的情况</li>
</ul>
<p>如果在程序执行过程中子进程异常退出，会是怎样的情况呢？</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/types.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;wait.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>exit_s</span>(<span style=color:#66d9ef>int</span> status) {
    <span style=color:#66d9ef>if</span> (WIFEXITED(status)) {
        printf(<span style=color:#e6db74>&#34;normal exist, status = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, WEXITSTATUS(status));
    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (WIFSIGNALED(status)) {
        printf(<span style=color:#e6db74>&#34;signal exit! status = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, WTERMSIG(status));
    }
}

<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>wait_test</span>() {
    pid_t pid_a;
    <span style=color:#66d9ef>int</span> status;
    <span style=color:#66d9ef>int</span> ret;

    pid_a <span style=color:#f92672>=</span> fork();
    <span style=color:#66d9ef>if</span> (pid_a <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
        printf(<span style=color:#e6db74>&#34;child process error</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        exit(<span style=color:#ae81ff>0</span>);
    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (pid_a <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
        printf(<span style=color:#e6db74>&#34;the pid of parent is %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, getpid());
        printf(<span style=color:#e6db74>&#34;wait child ...</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        <span style=color:#66d9ef>int</span> pid_child <span style=color:#f92672>=</span> wait(<span style=color:#f92672>&amp;</span>status);
        <span style=color:#66d9ef>if</span> (pid_child <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
            printf(<span style=color:#e6db74>&#34;i catch a child process with pid of %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, pid_child);
        }
        exit_s(status);
    } <span style=color:#66d9ef>else</span> {
        printf(<span style=color:#e6db74>&#34;the pid of child is %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, getpid());
        <span style=color:#75715e>// sleep(3);
</span><span style=color:#75715e></span>        pid_t pid <span style=color:#f92672>=</span> getpid();
        kill(pid, <span style=color:#ae81ff>9</span>);
        exit(<span style=color:#ae81ff>2</span>);
    }
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
    wait_test();
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>the pid of parent is <span style=color:#ae81ff>46749</span>
wait child ...
the pid of child is <span style=color:#ae81ff>46750</span>
i catch a child process with pid of <span style=color:#ae81ff>46750</span>
signal exit! status <span style=color:#f92672>=</span> <span style=color:#ae81ff>9</span>
</code></pre></td></tr></table>
</div>
</div><h3 id=线程>线程<a hidden class=anchor aria-hidden=true href=#线程>#</a></h3>
<p>需要先了解一下进程和线程的区别：</p>
<ul>
<li>进程是资源分配的最小单位，每个进程都占有独立内存空间。</li>
<li>线程是程序执行的最小单位，多个线程共享同一个内存空间。</li>
<li>一个进程由几个线程组成，线程与同属一个进程的其他线程共享当前进程拥有的全部资源。</li>
</ul>
<p>那么，线程有哪些优势呢？</p>
<ul>
<li>线程不需要额外的内存申请</li>
<li>线程共享进程内的数据，访问数据方便，而进程则需要通过通信的方式进行。</li>
</ul>
<p>在linux下，进程使用<code>ps</code>命令查看，<code>线程</code>则通过<code>top</code>命令来查看。还可以通过<code>top -p pid</code>来查看某个进程内的线程。</p>
<p>先看一个创建进程的例子：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;pthread.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>thread1</span>(<span style=color:#66d9ef>void</span>) {
    <span style=color:#66d9ef>int</span> i;
    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>5</span>; i<span style=color:#f92672>++</span>) {
        printf(<span style=color:#e6db74>&#34;this is the first thread</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        sleep(<span style=color:#ae81ff>1</span>);
    }
}

<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>thread2</span>(<span style=color:#66d9ef>void</span>) {
    <span style=color:#66d9ef>int</span> i;
    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>5</span>; i<span style=color:#f92672>++</span>) {
        printf(<span style=color:#e6db74>&#34;this is the second thread</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        sleep(<span style=color:#ae81ff>1</span>);
    }
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
    <span style=color:#66d9ef>int</span> ret <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    pthread_t id1, id2;
    pthread_create(<span style=color:#f92672>&amp;</span>id1, NULL, (<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>)thread1, NULL);
    pthread_create(<span style=color:#f92672>&amp;</span>id2, NULL, (<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>)thread2, NULL);
    pthread_join(id1, NULL);
    pthread_join(id2, NULL);
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></td></tr></table>
</div>
</div><p>在这里，<code>thread1</code>和<code>thread2</code>两个函数分别属于不同的线程。</p>
<p><code>pthread_t</code>是线程的id。</p>
<p><code>pthread_create()</code>是创建线程的函数，参数分别是：参数id，线程属性，线程运行函数的起始地址，运行函数的参数。</p>
<p>注意，由于<code>pthread</code>并非Linux系统的默认库，而是POSIX线程库，所以在编译的时候需要加上<code>-lpthread</code>来显式链接该库：<code>gcc -g main.c -lpthread</code>。</p>
<p>执行结果：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>this is the first thread
this is the second thread
this is the first thread
this is the second thread
this is the first thread
this is the second thread
this is the first thread
this is the second thread
this is the first thread
this is the second thread
</code></pre></td></tr></table>
</div>
</div><h2 id=进程间通信>进程间通信<a hidden class=anchor aria-hidden=true href=#进程间通信>#</a></h2>
<p>进程间的通信包括管道、共享内存、信号量通信、消息队列、套借口(socket)和全双工管道通信。</p>
<h3 id=管道>管道<a hidden class=anchor aria-hidden=true href=#管道>#</a></h3>
<p>管道顾名思义，就如同水管一样，当水从水管的一端流向另一端的时候，水流是单方向的。某一时刻只能从单方向传递数据，不能双向传递，这种就是半双工模式。半双工模式只能一端写数据，一端读数据，先来看一个半双工的例子：</p>
<ol>
<li>在父进程中通过<code>pipe()</code>函数创建一个管道，得到管道读端ppe[0]，写端ppe[1]。</li>
<li>在父进程中调用<code>fork()</code>产生一个子进程</li>
<li>在子进程中关闭ppe[0]，往ppe[1]中写入数据，在父进程中关闭ppe[1]，从ppe[0]中读取数据。</li>
</ol>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;wait.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>pipe_test</span>() {
    <span style=color:#66d9ef>int</span> ppe[<span style=color:#ae81ff>2</span>];

    <span style=color:#66d9ef>if</span> (pipe(ppe) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
        perror(<span style=color:#e6db74>&#34;not create a new process!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
    }

    <span style=color:#66d9ef>int</span> pid <span style=color:#f92672>=</span> fork();
    <span style=color:#66d9ef>if</span> (pid <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
        close(ppe[<span style=color:#ae81ff>0</span>]);
        printf(<span style=color:#e6db74>&#34;child process send message</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);

        <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;happy new year!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
        write(ppe[<span style=color:#ae81ff>1</span>], message, strlen(message));
    } <span style=color:#66d9ef>else</span> {
        close(ppe[<span style=color:#ae81ff>1</span>]);
        sleep(<span style=color:#ae81ff>2</span>);
        printf(<span style=color:#e6db74>&#34;parent process receive message</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        <span style=color:#66d9ef>char</span> message[<span style=color:#ae81ff>100</span>];
        <span style=color:#66d9ef>int</span> line <span style=color:#f92672>=</span> read(ppe[<span style=color:#ae81ff>0</span>], message, <span style=color:#ae81ff>100</span>);
        write(STDOUT_FILENO, message, line);
        wait(NULL);
        exit(<span style=color:#ae81ff>0</span>);
    }
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
    pipe_test();
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>child process send message
parent process receive message
happy new year!
</code></pre></td></tr></table>
</div>
</div><p>上面这个例子演示了单向通信，如果我们需要双向通信：父进程在读的同时也给子进程写。要实现这样的功能，就必须建立两个管道：一个管道从父进程流向子进程，一个管道从子进程流向父进程。</p>
<p>代码如下：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;wait.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>pipe_test</span>() {
    <span style=color:#66d9ef>int</span> ppea[<span style=color:#ae81ff>2</span>], ppeb[<span style=color:#ae81ff>2</span>];

    <span style=color:#66d9ef>if</span> (pipe(ppea) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>||</span> pipe(ppeb) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
        perror(<span style=color:#e6db74>&#34;not create a new process!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
    }

    <span style=color:#66d9ef>int</span> pid <span style=color:#f92672>=</span> fork();
    <span style=color:#66d9ef>if</span> (pid <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>) {
        perror(<span style=color:#e6db74>&#34;not create a new process !&#34;</span>);
        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (pid <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
        close(ppea[<span style=color:#ae81ff>0</span>]);
        printf(<span style=color:#e6db74>&#34;child process send message</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>message_send <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;happy new year!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
        write(ppea[<span style=color:#ae81ff>1</span>], message_send, strlen(message_send));

        sleep(<span style=color:#ae81ff>2</span>);

        close(ppeb[<span style=color:#ae81ff>1</span>]);
        printf(<span style=color:#e6db74>&#34;child process receive message</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        <span style=color:#66d9ef>char</span> message_receive[<span style=color:#ae81ff>100</span>];
        <span style=color:#66d9ef>int</span> line <span style=color:#f92672>=</span> read(ppeb[<span style=color:#ae81ff>0</span>], message_receive, <span style=color:#ae81ff>100</span>);
        write(STDOUT_FILENO, message_receive, line);
        exit(<span style=color:#ae81ff>0</span>);
    } <span style=color:#66d9ef>else</span> {
        close(ppea[<span style=color:#ae81ff>1</span>]);
        sleep(<span style=color:#ae81ff>2</span>);
        printf(<span style=color:#e6db74>&#34;parent process receive message</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        <span style=color:#66d9ef>char</span> message_receive[<span style=color:#ae81ff>100</span>];
        <span style=color:#66d9ef>int</span> line <span style=color:#f92672>=</span> read(ppea[<span style=color:#ae81ff>0</span>], message_receive, <span style=color:#ae81ff>100</span>);
        write(STDOUT_FILENO, message_receive, line);

        close(ppeb[<span style=color:#ae81ff>0</span>]);
        printf(<span style=color:#e6db74>&#34;parent process send message</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>message_send <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;happy new year my child!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
        write(ppeb[<span style=color:#ae81ff>1</span>], message_send, strlen(message_send));
        exit(<span style=color:#ae81ff>0</span>);
    }
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
    pipe_test();
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></td></tr></table>
</div>
</div><p>执行结果：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>child process send message
parent process receive message
happy new year!
parent process send message
child process receive message
happy new year my child!
</code></pre></td></tr></table>
</div>
</div><h3 id=命令管道>命令管道<a hidden class=anchor aria-hidden=true href=#命令管道>#</a></h3>
<p>上个部分介绍了管道，然而管道只能在有关联的进程中进行通信，也就是父子进程之间。那如果不相关的两个进程间也需要进行通信，这里就需要用到命令管道了，通常称为<code>FIFO</code>。通过这个名称可以知道命令管道遵循先进先出的原则，与数据结构中的队列类似。</p>
<p>创建一个命令管道有两种方法：</p>
<ul>
<li>通过shell命令创建</li>
<li>通过函数创建命名管道</li>
</ul>
<h4 id=shell命令创建命名管道>shell命令创建命名管道<a hidden class=anchor aria-hidden=true href=#shell命令创建命名管道>#</a></h4>
<ol>
<li>首先通过<code>mkfifo</code>创建一个管道文件test：<code>mkfifo test</code></li>
<li>通过<code>cat ./test</code>查看，此时，管道文件中没有任何数据</li>
<li>打开另一个终端，向FIFO中写入数据：<code>echo "hello fifo" > ./test</code></li>
<li>再次通过<code>cat ./test</code>查看，将会得到之前写入的数据。</li>
</ol>
<h4 id=函数创建命名管道>函数创建命名管道<a hidden class=anchor aria-hidden=true href=#函数创建命名管道>#</a></h4>
<p>下面通过c来实现命令管道：</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>//write.c
</span><span style=color:#75715e></span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;fcntl.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>mkfifo_write</span>() {
    <span style=color:#66d9ef>int</span> ppe <span style=color:#f92672>=</span> open(<span style=color:#e6db74>&#34;./fifo&#34;</span>, O_RDWR);
    printf(<span style=color:#e6db74>&#34;write the message:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);

    <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;hello world</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
    write(ppe, message, strlen(message));
    close(ppe);
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
    mkfifo_write();
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>//read.c
</span><span style=color:#75715e></span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;fcntl.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>mkfifo_read</span>() {
    <span style=color:#66d9ef>char</span> message[<span style=color:#ae81ff>100</span>];

    <span style=color:#66d9ef>int</span> ppe <span style=color:#f92672>=</span> open(<span style=color:#e6db74>&#34;./fifo&#34;</span>, O_RDWR);
    printf(<span style=color:#e6db74>&#34;read the message:</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
    <span style=color:#66d9ef>int</span> line <span style=color:#f92672>=</span> read(ppe, message, <span style=color:#ae81ff>100</span>);
    close(ppe);
    write(STDOUT_FILENO, message, line);
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> argv[]) {
    mkfifo_read();
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></td></tr></table>
</div>
</div><p>编译后，开启两个终端，一个终端先执行<code>./read</code>，另一个终端再执行<code>./write</code>，第一个终端中就会显示发出的信息。</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://www.niuwx.cn/tags/c/>C</a></li>
<li><a href=https://www.niuwx.cn/tags/linux/>Linux</a></li>
<li><a href=https://www.niuwx.cn/tags/%E7%BA%BF%E7%A8%8B/>线程</a></li>
<li><a href=https://www.niuwx.cn/tags/%E8%BF%9B%E7%A8%8B/>进程</a></li>
<li><a href=https://www.niuwx.cn/tags/%E7%AE%A1%E9%81%93/>管道</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://www.niuwx.cn/posts/other/manjaro_amd_nvidia/>
<span class=title>Next Page »</span>
<br>
<span>Manjaro下双显卡笔记本配置</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Linux C之进程 on twitter" href="https://twitter.com/intent/tweet/?text=Linux%20C%e4%b9%8b%e8%bf%9b%e7%a8%8b&url=https%3a%2f%2fwww.niuwx.cn%2fposts%2flinux%2flinux_c_1%2f&hashtags=C%2cLinux%2c%e7%ba%bf%e7%a8%8b%2c%e8%bf%9b%e7%a8%8b%2c%e7%ae%a1%e9%81%93"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Linux C之进程 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.niuwx.cn%2fposts%2flinux%2flinux_c_1%2f&title=Linux%20C%e4%b9%8b%e8%bf%9b%e7%a8%8b&summary=Linux%20C%e4%b9%8b%e8%bf%9b%e7%a8%8b&source=https%3a%2f%2fwww.niuwx.cn%2fposts%2flinux%2flinux_c_1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Linux C之进程 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.niuwx.cn%2fposts%2flinux%2flinux_c_1%2f&title=Linux%20C%e4%b9%8b%e8%bf%9b%e7%a8%8b"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Linux C之进程 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.niuwx.cn%2fposts%2flinux%2flinux_c_1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Linux C之进程 on whatsapp" href="https://api.whatsapp.com/send?text=Linux%20C%e4%b9%8b%e8%bf%9b%e7%a8%8b%20-%20https%3a%2f%2fwww.niuwx.cn%2fposts%2flinux%2flinux_c_1%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Linux C之进程 on telegram" href="https://telegram.me/share/url?text=Linux%20C%e4%b9%8b%e8%bf%9b%e7%a8%8b&url=https%3a%2f%2fwww.niuwx.cn%2fposts%2flinux%2flinux_c_1%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
<div id=gitalk-container></div>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css>
<script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script>
<script>var gitalk=new Gitalk({clientID:'020fa7d4d09265f4eb67',clientSecret:'29db217eaf1173794064f0e5bb3fa87004d111ba',repo:'isther.github.io',owner:'isther',admin:['isther'],id:location.pathname,distractionFreeMode:!1});gitalk.render('gitalk-container')</script>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://www.niuwx.cn/>Ther's Blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
<script type=text/javascript>document.write(unescape("%3Cspan id='cnzz_stat_icon_1279768046'%3E%3C/span%3E%3Cscript src='https://s4.cnzz.com/z_stat.php%3Fid%3D1279768046%26online%3D2' type='text/javascript'%3E%3C/script%3E"))</script>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>